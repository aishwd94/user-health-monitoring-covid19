{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "import pandas as pd, numpy as np, matplotlib.pyplot as plt\n",
    "from sklearn.cluster import DBSCAN\n",
    "from geopy.distance import great_circle\n",
    "from shapely.geometry import MultiPoint\n",
    "from numpy import random"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "df = pd.read_parquet(r'C:\\shared_folder\\github_projects\\data\\tmp.parquet')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>device_key</th>\n",
       "      <th>unix_time</th>\n",
       "      <th>min_duration_seconds</th>\n",
       "      <th>observation_count</th>\n",
       "      <th>latitude</th>\n",
       "      <th>longitude</th>\n",
       "      <th>zipcode_5</th>\n",
       "      <th>state_abbr</th>\n",
       "      <th>cluster_type2</th>\n",
       "      <th>datetime</th>\n",
       "      <th>str_time</th>\n",
       "      <th>end_time</th>\n",
       "      <th>datetime_str_time</th>\n",
       "      <th>datetime_end_time</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>1188</td>\n",
       "      <td>1546378629</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>41.854000</td>\n",
       "      <td>-87.651000</td>\n",
       "      <td>60608</td>\n",
       "      <td>IL</td>\n",
       "      <td>v</td>\n",
       "      <td>2019-01-01 21:37:09+00:00</td>\n",
       "      <td>1546378629</td>\n",
       "      <td>1546378629</td>\n",
       "      <td>2019-01-01 21:37:09+00:00</td>\n",
       "      <td>2019-01-01 21:37:09+00:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>2048</td>\n",
       "      <td>1546353483</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>41.840390</td>\n",
       "      <td>-87.783210</td>\n",
       "      <td>60402</td>\n",
       "      <td>IL</td>\n",
       "      <td>v</td>\n",
       "      <td>2019-01-01 14:38:03+00:00</td>\n",
       "      <td>1546353483</td>\n",
       "      <td>1546353483</td>\n",
       "      <td>2019-01-01 14:38:03+00:00</td>\n",
       "      <td>2019-01-01 14:38:03+00:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>2048</td>\n",
       "      <td>1546538227</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>41.849730</td>\n",
       "      <td>-87.728900</td>\n",
       "      <td>60623</td>\n",
       "      <td>IL</td>\n",
       "      <td>v</td>\n",
       "      <td>2019-01-03 17:57:07+00:00</td>\n",
       "      <td>1546538227</td>\n",
       "      <td>1546538227</td>\n",
       "      <td>2019-01-03 17:57:07+00:00</td>\n",
       "      <td>2019-01-03 17:57:07+00:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>2362</td>\n",
       "      <td>1546549696</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>42.247950</td>\n",
       "      <td>-88.000360</td>\n",
       "      <td>60060</td>\n",
       "      <td>IL</td>\n",
       "      <td>v</td>\n",
       "      <td>2019-01-03 21:08:16+00:00</td>\n",
       "      <td>1546549696</td>\n",
       "      <td>1546549696</td>\n",
       "      <td>2019-01-03 21:08:16+00:00</td>\n",
       "      <td>2019-01-03 21:08:16+00:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>2362</td>\n",
       "      <td>1546549697</td>\n",
       "      <td>61</td>\n",
       "      <td>3</td>\n",
       "      <td>42.247810</td>\n",
       "      <td>-88.000450</td>\n",
       "      <td>60060</td>\n",
       "      <td>IL</td>\n",
       "      <td>t1</td>\n",
       "      <td>2019-01-03 21:08:17+00:00</td>\n",
       "      <td>1546549697</td>\n",
       "      <td>1546549758</td>\n",
       "      <td>2019-01-03 21:08:17+00:00</td>\n",
       "      <td>2019-01-03 21:09:18+00:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>64275</td>\n",
       "      <td>45822518</td>\n",
       "      <td>1546566702</td>\n",
       "      <td>451</td>\n",
       "      <td>3</td>\n",
       "      <td>42.378600</td>\n",
       "      <td>-87.938230</td>\n",
       "      <td>60031</td>\n",
       "      <td>IL</td>\n",
       "      <td>t2</td>\n",
       "      <td>2019-01-04 01:51:42+00:00</td>\n",
       "      <td>1546566702</td>\n",
       "      <td>1546567153</td>\n",
       "      <td>2019-01-04 01:51:42+00:00</td>\n",
       "      <td>2019-01-04 01:59:13+00:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>64276</td>\n",
       "      <td>45822518</td>\n",
       "      <td>1546567003</td>\n",
       "      <td>6068</td>\n",
       "      <td>8</td>\n",
       "      <td>42.378633</td>\n",
       "      <td>-87.938868</td>\n",
       "      <td>60031</td>\n",
       "      <td>IL</td>\n",
       "      <td>v</td>\n",
       "      <td>2019-01-04 01:56:43+00:00</td>\n",
       "      <td>1546567003</td>\n",
       "      <td>1546573071</td>\n",
       "      <td>2019-01-04 01:56:43+00:00</td>\n",
       "      <td>2019-01-04 03:37:51+00:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>64277</td>\n",
       "      <td>45822518</td>\n",
       "      <td>1546574048</td>\n",
       "      <td>4900</td>\n",
       "      <td>5</td>\n",
       "      <td>42.382926</td>\n",
       "      <td>-87.980864</td>\n",
       "      <td>60031</td>\n",
       "      <td>IL</td>\n",
       "      <td>v</td>\n",
       "      <td>2019-01-04 03:54:08+00:00</td>\n",
       "      <td>1546574048</td>\n",
       "      <td>1546578948</td>\n",
       "      <td>2019-01-04 03:54:08+00:00</td>\n",
       "      <td>2019-01-04 05:15:48+00:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>64278</td>\n",
       "      <td>45822518</td>\n",
       "      <td>1546582682</td>\n",
       "      <td>8195</td>\n",
       "      <td>5</td>\n",
       "      <td>42.382920</td>\n",
       "      <td>-87.980898</td>\n",
       "      <td>60031</td>\n",
       "      <td>IL</td>\n",
       "      <td>v</td>\n",
       "      <td>2019-01-04 06:18:02+00:00</td>\n",
       "      <td>1546582682</td>\n",
       "      <td>1546590877</td>\n",
       "      <td>2019-01-04 06:18:02+00:00</td>\n",
       "      <td>2019-01-04 08:34:37+00:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>64279</td>\n",
       "      <td>45822518</td>\n",
       "      <td>1546595857</td>\n",
       "      <td>2356</td>\n",
       "      <td>3</td>\n",
       "      <td>42.382933</td>\n",
       "      <td>-87.980940</td>\n",
       "      <td>60031</td>\n",
       "      <td>IL</td>\n",
       "      <td>v</td>\n",
       "      <td>2019-01-04 09:57:37+00:00</td>\n",
       "      <td>1546595857</td>\n",
       "      <td>1546598213</td>\n",
       "      <td>2019-01-04 09:57:37+00:00</td>\n",
       "      <td>2019-01-04 10:36:53+00:00</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>1000000 rows × 14 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "       device_key   unix_time  min_duration_seconds  observation_count  \\\n",
       "0            1188  1546378629                     0                  1   \n",
       "1            2048  1546353483                     0                  1   \n",
       "2            2048  1546538227                     0                  1   \n",
       "3            2362  1546549696                     0                  1   \n",
       "4            2362  1546549697                    61                  3   \n",
       "...           ...         ...                   ...                ...   \n",
       "64275    45822518  1546566702                   451                  3   \n",
       "64276    45822518  1546567003                  6068                  8   \n",
       "64277    45822518  1546574048                  4900                  5   \n",
       "64278    45822518  1546582682                  8195                  5   \n",
       "64279    45822518  1546595857                  2356                  3   \n",
       "\n",
       "        latitude  longitude zipcode_5 state_abbr cluster_type2  \\\n",
       "0      41.854000 -87.651000     60608         IL             v   \n",
       "1      41.840390 -87.783210     60402         IL             v   \n",
       "2      41.849730 -87.728900     60623         IL             v   \n",
       "3      42.247950 -88.000360     60060         IL             v   \n",
       "4      42.247810 -88.000450     60060         IL            t1   \n",
       "...          ...        ...       ...        ...           ...   \n",
       "64275  42.378600 -87.938230     60031         IL            t2   \n",
       "64276  42.378633 -87.938868     60031         IL             v   \n",
       "64277  42.382926 -87.980864     60031         IL             v   \n",
       "64278  42.382920 -87.980898     60031         IL             v   \n",
       "64279  42.382933 -87.980940     60031         IL             v   \n",
       "\n",
       "                       datetime    str_time    end_time  \\\n",
       "0     2019-01-01 21:37:09+00:00  1546378629  1546378629   \n",
       "1     2019-01-01 14:38:03+00:00  1546353483  1546353483   \n",
       "2     2019-01-03 17:57:07+00:00  1546538227  1546538227   \n",
       "3     2019-01-03 21:08:16+00:00  1546549696  1546549696   \n",
       "4     2019-01-03 21:08:17+00:00  1546549697  1546549758   \n",
       "...                         ...         ...         ...   \n",
       "64275 2019-01-04 01:51:42+00:00  1546566702  1546567153   \n",
       "64276 2019-01-04 01:56:43+00:00  1546567003  1546573071   \n",
       "64277 2019-01-04 03:54:08+00:00  1546574048  1546578948   \n",
       "64278 2019-01-04 06:18:02+00:00  1546582682  1546590877   \n",
       "64279 2019-01-04 09:57:37+00:00  1546595857  1546598213   \n",
       "\n",
       "              datetime_str_time         datetime_end_time  \n",
       "0     2019-01-01 21:37:09+00:00 2019-01-01 21:37:09+00:00  \n",
       "1     2019-01-01 14:38:03+00:00 2019-01-01 14:38:03+00:00  \n",
       "2     2019-01-03 17:57:07+00:00 2019-01-03 17:57:07+00:00  \n",
       "3     2019-01-03 21:08:16+00:00 2019-01-03 21:08:16+00:00  \n",
       "4     2019-01-03 21:08:17+00:00 2019-01-03 21:09:18+00:00  \n",
       "...                         ...                       ...  \n",
       "64275 2019-01-04 01:51:42+00:00 2019-01-04 01:59:13+00:00  \n",
       "64276 2019-01-04 01:56:43+00:00 2019-01-04 03:37:51+00:00  \n",
       "64277 2019-01-04 03:54:08+00:00 2019-01-04 05:15:48+00:00  \n",
       "64278 2019-01-04 06:18:02+00:00 2019-01-04 08:34:37+00:00  \n",
       "64279 2019-01-04 09:57:37+00:00 2019-01-04 10:36:53+00:00  \n",
       "\n",
       "[1000000 rows x 14 columns]"
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>device_key</th>\n",
       "      <th>unix_time</th>\n",
       "      <th>min_duration_seconds</th>\n",
       "      <th>observation_count</th>\n",
       "      <th>latitude</th>\n",
       "      <th>longitude</th>\n",
       "      <th>zipcode_5</th>\n",
       "      <th>state_abbr</th>\n",
       "      <th>cluster_type2</th>\n",
       "      <th>datetime</th>\n",
       "      <th>str_time</th>\n",
       "      <th>end_time</th>\n",
       "      <th>datetime_str_time</th>\n",
       "      <th>datetime_end_time</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>1188</td>\n",
       "      <td>1546378629</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>41.854000</td>\n",
       "      <td>-87.651000</td>\n",
       "      <td>60608</td>\n",
       "      <td>IL</td>\n",
       "      <td>v</td>\n",
       "      <td>2019-01-01 21:37:09+00:00</td>\n",
       "      <td>1546378629</td>\n",
       "      <td>1546378629</td>\n",
       "      <td>2019-01-01 21:37:09+00:00</td>\n",
       "      <td>2019-01-01 21:37:09+00:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>2048</td>\n",
       "      <td>1546353483</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>41.840390</td>\n",
       "      <td>-87.783210</td>\n",
       "      <td>60402</td>\n",
       "      <td>IL</td>\n",
       "      <td>v</td>\n",
       "      <td>2019-01-01 14:38:03+00:00</td>\n",
       "      <td>1546353483</td>\n",
       "      <td>1546353483</td>\n",
       "      <td>2019-01-01 14:38:03+00:00</td>\n",
       "      <td>2019-01-01 14:38:03+00:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>2048</td>\n",
       "      <td>1546538227</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>41.849730</td>\n",
       "      <td>-87.728900</td>\n",
       "      <td>60623</td>\n",
       "      <td>IL</td>\n",
       "      <td>v</td>\n",
       "      <td>2019-01-03 17:57:07+00:00</td>\n",
       "      <td>1546538227</td>\n",
       "      <td>1546538227</td>\n",
       "      <td>2019-01-03 17:57:07+00:00</td>\n",
       "      <td>2019-01-03 17:57:07+00:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>2362</td>\n",
       "      <td>1546549696</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>42.247950</td>\n",
       "      <td>-88.000360</td>\n",
       "      <td>60060</td>\n",
       "      <td>IL</td>\n",
       "      <td>v</td>\n",
       "      <td>2019-01-03 21:08:16+00:00</td>\n",
       "      <td>1546549696</td>\n",
       "      <td>1546549696</td>\n",
       "      <td>2019-01-03 21:08:16+00:00</td>\n",
       "      <td>2019-01-03 21:08:16+00:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>2362</td>\n",
       "      <td>1546549697</td>\n",
       "      <td>61</td>\n",
       "      <td>3</td>\n",
       "      <td>42.247810</td>\n",
       "      <td>-88.000450</td>\n",
       "      <td>60060</td>\n",
       "      <td>IL</td>\n",
       "      <td>t1</td>\n",
       "      <td>2019-01-03 21:08:17+00:00</td>\n",
       "      <td>1546549697</td>\n",
       "      <td>1546549758</td>\n",
       "      <td>2019-01-03 21:08:17+00:00</td>\n",
       "      <td>2019-01-03 21:09:18+00:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>64275</td>\n",
       "      <td>45822518</td>\n",
       "      <td>1546566702</td>\n",
       "      <td>451</td>\n",
       "      <td>3</td>\n",
       "      <td>42.378600</td>\n",
       "      <td>-87.938230</td>\n",
       "      <td>60031</td>\n",
       "      <td>IL</td>\n",
       "      <td>t2</td>\n",
       "      <td>2019-01-04 01:51:42+00:00</td>\n",
       "      <td>1546566702</td>\n",
       "      <td>1546567153</td>\n",
       "      <td>2019-01-04 01:51:42+00:00</td>\n",
       "      <td>2019-01-04 01:59:13+00:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>64276</td>\n",
       "      <td>45822518</td>\n",
       "      <td>1546567003</td>\n",
       "      <td>6068</td>\n",
       "      <td>8</td>\n",
       "      <td>42.378633</td>\n",
       "      <td>-87.938868</td>\n",
       "      <td>60031</td>\n",
       "      <td>IL</td>\n",
       "      <td>v</td>\n",
       "      <td>2019-01-04 01:56:43+00:00</td>\n",
       "      <td>1546567003</td>\n",
       "      <td>1546573071</td>\n",
       "      <td>2019-01-04 01:56:43+00:00</td>\n",
       "      <td>2019-01-04 03:37:51+00:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>64277</td>\n",
       "      <td>45822518</td>\n",
       "      <td>1546574048</td>\n",
       "      <td>4900</td>\n",
       "      <td>5</td>\n",
       "      <td>42.382926</td>\n",
       "      <td>-87.980864</td>\n",
       "      <td>60031</td>\n",
       "      <td>IL</td>\n",
       "      <td>v</td>\n",
       "      <td>2019-01-04 03:54:08+00:00</td>\n",
       "      <td>1546574048</td>\n",
       "      <td>1546578948</td>\n",
       "      <td>2019-01-04 03:54:08+00:00</td>\n",
       "      <td>2019-01-04 05:15:48+00:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>64278</td>\n",
       "      <td>45822518</td>\n",
       "      <td>1546582682</td>\n",
       "      <td>8195</td>\n",
       "      <td>5</td>\n",
       "      <td>42.382920</td>\n",
       "      <td>-87.980898</td>\n",
       "      <td>60031</td>\n",
       "      <td>IL</td>\n",
       "      <td>v</td>\n",
       "      <td>2019-01-04 06:18:02+00:00</td>\n",
       "      <td>1546582682</td>\n",
       "      <td>1546590877</td>\n",
       "      <td>2019-01-04 06:18:02+00:00</td>\n",
       "      <td>2019-01-04 08:34:37+00:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>64279</td>\n",
       "      <td>45822518</td>\n",
       "      <td>1546595857</td>\n",
       "      <td>2356</td>\n",
       "      <td>3</td>\n",
       "      <td>42.382933</td>\n",
       "      <td>-87.980940</td>\n",
       "      <td>60031</td>\n",
       "      <td>IL</td>\n",
       "      <td>v</td>\n",
       "      <td>2019-01-04 09:57:37+00:00</td>\n",
       "      <td>1546595857</td>\n",
       "      <td>1546598213</td>\n",
       "      <td>2019-01-04 09:57:37+00:00</td>\n",
       "      <td>2019-01-04 10:36:53+00:00</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>617885 rows × 14 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "       device_key   unix_time  min_duration_seconds  observation_count  \\\n",
       "0            1188  1546378629                     0                  1   \n",
       "1            2048  1546353483                     0                  1   \n",
       "2            2048  1546538227                     0                  1   \n",
       "3            2362  1546549696                     0                  1   \n",
       "4            2362  1546549697                    61                  3   \n",
       "...           ...         ...                   ...                ...   \n",
       "64275    45822518  1546566702                   451                  3   \n",
       "64276    45822518  1546567003                  6068                  8   \n",
       "64277    45822518  1546574048                  4900                  5   \n",
       "64278    45822518  1546582682                  8195                  5   \n",
       "64279    45822518  1546595857                  2356                  3   \n",
       "\n",
       "        latitude  longitude zipcode_5 state_abbr cluster_type2  \\\n",
       "0      41.854000 -87.651000     60608         IL             v   \n",
       "1      41.840390 -87.783210     60402         IL             v   \n",
       "2      41.849730 -87.728900     60623         IL             v   \n",
       "3      42.247950 -88.000360     60060         IL             v   \n",
       "4      42.247810 -88.000450     60060         IL            t1   \n",
       "...          ...        ...       ...        ...           ...   \n",
       "64275  42.378600 -87.938230     60031         IL            t2   \n",
       "64276  42.378633 -87.938868     60031         IL             v   \n",
       "64277  42.382926 -87.980864     60031         IL             v   \n",
       "64278  42.382920 -87.980898     60031         IL             v   \n",
       "64279  42.382933 -87.980940     60031         IL             v   \n",
       "\n",
       "                       datetime    str_time    end_time  \\\n",
       "0     2019-01-01 21:37:09+00:00  1546378629  1546378629   \n",
       "1     2019-01-01 14:38:03+00:00  1546353483  1546353483   \n",
       "2     2019-01-03 17:57:07+00:00  1546538227  1546538227   \n",
       "3     2019-01-03 21:08:16+00:00  1546549696  1546549696   \n",
       "4     2019-01-03 21:08:17+00:00  1546549697  1546549758   \n",
       "...                         ...         ...         ...   \n",
       "64275 2019-01-04 01:51:42+00:00  1546566702  1546567153   \n",
       "64276 2019-01-04 01:56:43+00:00  1546567003  1546573071   \n",
       "64277 2019-01-04 03:54:08+00:00  1546574048  1546578948   \n",
       "64278 2019-01-04 06:18:02+00:00  1546582682  1546590877   \n",
       "64279 2019-01-04 09:57:37+00:00  1546595857  1546598213   \n",
       "\n",
       "              datetime_str_time         datetime_end_time  \n",
       "0     2019-01-01 21:37:09+00:00 2019-01-01 21:37:09+00:00  \n",
       "1     2019-01-01 14:38:03+00:00 2019-01-01 14:38:03+00:00  \n",
       "2     2019-01-03 17:57:07+00:00 2019-01-03 17:57:07+00:00  \n",
       "3     2019-01-03 21:08:16+00:00 2019-01-03 21:08:16+00:00  \n",
       "4     2019-01-03 21:08:17+00:00 2019-01-03 21:09:18+00:00  \n",
       "...                         ...                       ...  \n",
       "64275 2019-01-04 01:51:42+00:00 2019-01-04 01:59:13+00:00  \n",
       "64276 2019-01-04 01:56:43+00:00 2019-01-04 03:37:51+00:00  \n",
       "64277 2019-01-04 03:54:08+00:00 2019-01-04 05:15:48+00:00  \n",
       "64278 2019-01-04 06:18:02+00:00 2019-01-04 08:34:37+00:00  \n",
       "64279 2019-01-04 09:57:37+00:00 2019-01-04 10:36:53+00:00  \n",
       "\n",
       "[617885 rows x 14 columns]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df = df.drop_duplicates(subset=['device_key','longitude','latitude'])\n",
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [],
   "source": [
    "ndf = df.head(1000)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>unix_time</th>\n",
       "      <th>device_key</th>\n",
       "      <th>latitude</th>\n",
       "      <th>longitude</th>\n",
       "      <th>min_duration_seconds</th>\n",
       "      <th>dupl_idx</th>\n",
       "      <th>str_time</th>\n",
       "      <th>end_time</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>1607897553</td>\n",
       "      <td>552</td>\n",
       "      <td>66.095531</td>\n",
       "      <td>-80.487888</td>\n",
       "      <td>1</td>\n",
       "      <td>False</td>\n",
       "      <td>1607897553</td>\n",
       "      <td>1607897554</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>1607897554</td>\n",
       "      <td>552</td>\n",
       "      <td>56.304469</td>\n",
       "      <td>-89.771636</td>\n",
       "      <td>6</td>\n",
       "      <td>False</td>\n",
       "      <td>1607897554</td>\n",
       "      <td>1607897560</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>1607897555</td>\n",
       "      <td>552</td>\n",
       "      <td>69.680385</td>\n",
       "      <td>-97.546706</td>\n",
       "      <td>2</td>\n",
       "      <td>False</td>\n",
       "      <td>1607897555</td>\n",
       "      <td>1607897557</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>1607897556</td>\n",
       "      <td>437</td>\n",
       "      <td>46.255378</td>\n",
       "      <td>-89.170995</td>\n",
       "      <td>7</td>\n",
       "      <td>False</td>\n",
       "      <td>1607897556</td>\n",
       "      <td>1607897563</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>1607897557</td>\n",
       "      <td>437</td>\n",
       "      <td>57.704822</td>\n",
       "      <td>-92.932916</td>\n",
       "      <td>11</td>\n",
       "      <td>False</td>\n",
       "      <td>1607897557</td>\n",
       "      <td>1607897568</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>218</td>\n",
       "      <td>1607897633</td>\n",
       "      <td>681</td>\n",
       "      <td>40.293148</td>\n",
       "      <td>-84.435284</td>\n",
       "      <td>20</td>\n",
       "      <td>66</td>\n",
       "      <td>1607897622</td>\n",
       "      <td>1607897642</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>219</td>\n",
       "      <td>1607897633</td>\n",
       "      <td>584</td>\n",
       "      <td>53.360444</td>\n",
       "      <td>-90.539179</td>\n",
       "      <td>3</td>\n",
       "      <td>68</td>\n",
       "      <td>1607897622</td>\n",
       "      <td>1607897625</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>220</td>\n",
       "      <td>1607897629</td>\n",
       "      <td>740</td>\n",
       "      <td>53.360444</td>\n",
       "      <td>-90.539180</td>\n",
       "      <td>1</td>\n",
       "      <td>68</td>\n",
       "      <td>1607897623</td>\n",
       "      <td>1607897624</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>221</td>\n",
       "      <td>1607897643</td>\n",
       "      <td>162</td>\n",
       "      <td>53.360444</td>\n",
       "      <td>-90.539179</td>\n",
       "      <td>7</td>\n",
       "      <td>68</td>\n",
       "      <td>1607897624</td>\n",
       "      <td>1607897631</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>222</td>\n",
       "      <td>1607897634</td>\n",
       "      <td>921</td>\n",
       "      <td>53.360444</td>\n",
       "      <td>-90.539179</td>\n",
       "      <td>4</td>\n",
       "      <td>68</td>\n",
       "      <td>1607897625</td>\n",
       "      <td>1607897629</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>223 rows × 8 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "      unix_time device_key   latitude  longitude min_duration_seconds  \\\n",
       "0    1607897553        552  66.095531 -80.487888                    1   \n",
       "1    1607897554        552  56.304469 -89.771636                    6   \n",
       "2    1607897555        552  69.680385 -97.546706                    2   \n",
       "3    1607897556        437  46.255378 -89.170995                    7   \n",
       "4    1607897557        437  57.704822 -92.932916                   11   \n",
       "..          ...        ...        ...        ...                  ...   \n",
       "218  1607897633        681  40.293148 -84.435284                   20   \n",
       "219  1607897633        584  53.360444 -90.539179                    3   \n",
       "220  1607897629        740  53.360444 -90.539180                    1   \n",
       "221  1607897643        162  53.360444 -90.539179                    7   \n",
       "222  1607897634        921  53.360444 -90.539179                    4   \n",
       "\n",
       "    dupl_idx    str_time    end_time  \n",
       "0      False  1607897553  1607897554  \n",
       "1      False  1607897554  1607897560  \n",
       "2      False  1607897555  1607897557  \n",
       "3      False  1607897556  1607897563  \n",
       "4      False  1607897557  1607897568  \n",
       "..       ...         ...         ...  \n",
       "218       66  1607897622  1607897642  \n",
       "219       68  1607897622  1607897625  \n",
       "220       68  1607897623  1607897624  \n",
       "221       68  1607897624  1607897631  \n",
       "222       68  1607897625  1607897629  \n",
       "\n",
       "[223 rows x 8 columns]"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "def get_sample_data(n=20):\n",
    "    df = pd.DataFrame( columns=['unix_time','device_key','latitude','longitude','min_duration_seconds','dupl_idx','str_time','end_time'])\n",
    "    t = 1607897552\n",
    "    for i in range(n): \n",
    "        key=random.randint(100,999)\n",
    "        lat=random.uniform(40,70)\n",
    "        long=random.uniform(-80,-100)\n",
    "        for j in range(random.randint(2,6)):\n",
    "            t += 1\n",
    "            d = random.randint(0,24)\n",
    "            df = df.append({\n",
    "                        'unix_time': t,\n",
    "                        'device_key':str(key),\n",
    "                        'latitude':random.uniform(40,70)  ,\n",
    "                        'longitude':random.uniform(-80,-100),\n",
    "                        'min_duration_seconds': d,\n",
    "                        'str_time': t,\n",
    "                        'end_time': t + d,\n",
    "                        'dupl_idx':\"False\"},\n",
    "                        ignore_index=True)   \n",
    "    keys = df['device_key'].tolist()\n",
    "    for index, row in df.iterrows():\n",
    "        if(random.uniform()>0.5):\n",
    "            t = row['unix_time']\n",
    "            for _ in range(random.randint(2,6)):\n",
    "                t += 1\n",
    "                d = random.randint(0,24)\n",
    "                df = df.append({\n",
    "                    'unix_time': t + random.randint(0,20),\n",
    "                    'device_key':random.choice(keys),\n",
    "                    'latitude': row['latitude']+ random.random()*0.000001  ,\n",
    "                    'longitude': row['longitude'] + random.random()*0.000001,\n",
    "                    'min_duration_seconds' : d,\n",
    "                    'str_time': t,\n",
    "                    'end_time': t + d,\n",
    "                    'dupl_idx': index },\n",
    "                    ignore_index=True) \n",
    "    return df\n",
    "    \n",
    "df = get_sample_data(20)\n",
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "c:\\users\\aishw\\appdata\\local\\programs\\python\\python37\\lib\\site-packages\\ipykernel_launcher.py:2: FutureWarning: Method .as_matrix will be removed in a future version. Use .values instead.\n",
      "  \n"
     ]
    }
   ],
   "source": [
    "ndf = df\n",
    "coords = ndf.as_matrix(columns=['latitude', 'longitude'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([[ 66.09553125, -80.48788822],\n",
       "       [ 56.30446898, -89.77163621],\n",
       "       [ 69.6803848 , -97.54670568],\n",
       "       [ 46.25537765, -89.17099479],\n",
       "       [ 57.7048223 , -92.93291622],\n",
       "       [ 53.97979522, -86.60986612],\n",
       "       [ 46.93993497, -97.42480113],\n",
       "       [ 58.80334591, -88.42871932],\n",
       "       [ 68.16428759, -86.91395648],\n",
       "       [ 48.31701066, -91.44721127],\n",
       "       [ 68.6655799 , -89.24382312],\n",
       "       [ 49.36116647, -97.43664811],\n",
       "       [ 69.63185989, -98.95519125],\n",
       "       [ 40.37371351, -85.24471736],\n",
       "       [ 64.97421498, -87.19161612],\n",
       "       [ 55.76750312, -91.53029756],\n",
       "       [ 60.12897147, -96.7723957 ],\n",
       "       [ 68.77728485, -87.53190832],\n",
       "       [ 47.40928549, -93.10841229],\n",
       "       [ 54.42846679, -92.29046507],\n",
       "       [ 61.32159735, -82.40397324],\n",
       "       [ 47.42396618, -82.67853211],\n",
       "       [ 59.84921269, -94.79552406],\n",
       "       [ 61.7472398 , -89.77313045],\n",
       "       [ 65.95126367, -97.66388154],\n",
       "       [ 52.12320987, -86.79931735],\n",
       "       [ 63.4026671 , -83.23579591],\n",
       "       [ 61.70797963, -93.29999873],\n",
       "       [ 50.03839243, -82.89858857],\n",
       "       [ 55.51043578, -86.24812992],\n",
       "       [ 41.09478404, -94.94034312],\n",
       "       [ 56.43125923, -91.59615306],\n",
       "       [ 50.35422239, -90.48667524],\n",
       "       [ 41.23806117, -94.57808446],\n",
       "       [ 51.62378602, -90.67784072],\n",
       "       [ 58.16111667, -93.76152467],\n",
       "       [ 50.94273858, -82.5407153 ],\n",
       "       [ 52.8966529 , -90.60439045],\n",
       "       [ 52.03840593, -92.44749217],\n",
       "       [ 46.03590603, -88.69756561],\n",
       "       [ 57.52301852, -95.66970359],\n",
       "       [ 40.99703197, -89.43819774],\n",
       "       [ 61.43774564, -89.35503472],\n",
       "       [ 53.34347724, -89.43821059],\n",
       "       [ 67.80681706, -81.74795708],\n",
       "       [ 43.93047365, -94.99375723],\n",
       "       [ 63.99819508, -92.50069561],\n",
       "       [ 60.47891007, -95.00992338],\n",
       "       [ 69.95068585, -92.199104  ],\n",
       "       [ 60.36427271, -92.87232911],\n",
       "       [ 45.42386657, -86.2666786 ],\n",
       "       [ 47.24875716, -99.92821621],\n",
       "       [ 56.65877412, -82.79695754],\n",
       "       [ 58.15637205, -83.50714178],\n",
       "       [ 44.641682  , -86.17574552],\n",
       "       [ 61.34832178, -83.47297409],\n",
       "       [ 68.20498546, -87.04281843],\n",
       "       [ 69.24235288, -81.12528618],\n",
       "       [ 65.79505833, -85.82569751],\n",
       "       [ 63.40564407, -84.09810712],\n",
       "       [ 59.27923761, -93.26799013],\n",
       "       [ 67.40142626, -91.44779817],\n",
       "       [ 60.58422413, -80.7676253 ],\n",
       "       [ 68.79452935, -93.37671949],\n",
       "       [ 41.76390708, -82.30578658],\n",
       "       [ 54.34634197, -88.34481905],\n",
       "       [ 40.29314712, -84.4352849 ],\n",
       "       [ 57.00968316, -82.37605953],\n",
       "       [ 53.36044358, -90.53917977],\n",
       "       [ 66.09553193, -80.48788747],\n",
       "       [ 66.09553172, -80.48788761],\n",
       "       [ 66.09553142, -80.48788817],\n",
       "       [ 56.30446907, -89.77163562],\n",
       "       [ 56.30446993, -89.77163604],\n",
       "       [ 46.25537818, -89.17099438],\n",
       "       [ 46.25537776, -89.17099432],\n",
       "       [ 46.25537829, -89.17099428],\n",
       "       [ 46.25537858, -89.17099448],\n",
       "       [ 46.25537822, -89.17099436],\n",
       "       [ 46.93993576, -97.42480024],\n",
       "       [ 46.93993543, -97.424801  ],\n",
       "       [ 46.93993538, -97.42480029],\n",
       "       [ 46.93993563, -97.42480091],\n",
       "       [ 48.31701079, -91.44721092],\n",
       "       [ 48.31701155, -91.44721096],\n",
       "       [ 48.31701125, -91.44721065],\n",
       "       [ 48.31701126, -91.44721096],\n",
       "       [ 68.66558034, -89.2438231 ],\n",
       "       [ 68.66558081, -89.24382268],\n",
       "       [ 49.36116734, -97.43664746],\n",
       "       [ 49.36116647, -97.43664734],\n",
       "       [ 69.63186031, -98.95519114],\n",
       "       [ 69.63186074, -98.95519111],\n",
       "       [ 69.63186078, -98.95519111],\n",
       "       [ 69.63186   , -98.95519047],\n",
       "       [ 55.76750328, -91.5302967 ],\n",
       "       [ 55.76750352, -91.53029704],\n",
       "       [ 55.76750372, -91.53029752],\n",
       "       [ 60.12897164, -96.77239532],\n",
       "       [ 60.12897184, -96.77239567],\n",
       "       [ 60.12897211, -96.77239474],\n",
       "       [ 60.1289715 , -96.77239482],\n",
       "       [ 60.12897237, -96.77239475],\n",
       "       [ 68.77728561, -87.5319079 ],\n",
       "       [ 68.77728582, -87.53190785],\n",
       "       [ 68.77728542, -87.5319076 ],\n",
       "       [ 47.40928551, -93.10841172],\n",
       "       [ 47.4092857 , -93.10841187],\n",
       "       [ 47.40928604, -93.10841133],\n",
       "       [ 47.40928611, -93.10841178],\n",
       "       [ 54.42846706, -92.29046453],\n",
       "       [ 54.42846743, -92.2904648 ],\n",
       "       [ 61.32159748, -82.40397286],\n",
       "       [ 61.32159827, -82.4039727 ],\n",
       "       [ 47.42396656, -82.67853183],\n",
       "       [ 47.4239665 , -82.67853173],\n",
       "       [ 47.42396688, -82.67853176],\n",
       "       [ 59.84921363, -94.79552339],\n",
       "       [ 59.84921347, -94.79552317],\n",
       "       [ 61.74724047, -89.77313011],\n",
       "       [ 61.74724007, -89.77312982],\n",
       "       [ 61.74724012, -89.77313034],\n",
       "       [ 65.95126405, -97.66388131],\n",
       "       [ 65.9512645 , -97.6638807 ],\n",
       "       [ 52.12321052, -86.79931712],\n",
       "       [ 52.12321063, -86.79931728],\n",
       "       [ 52.12321041, -86.79931658],\n",
       "       [ 52.1232103 , -86.79931644],\n",
       "       [ 63.40266722, -83.23579575],\n",
       "       [ 63.40266754, -83.23579557],\n",
       "       [ 63.40266713, -83.23579538],\n",
       "       [ 63.40266786, -83.23579548],\n",
       "       [ 63.40266731, -83.23579496],\n",
       "       [ 61.70798057, -93.29999801],\n",
       "       [ 61.70798009, -93.29999821],\n",
       "       [ 61.70797991, -93.299998  ],\n",
       "       [ 61.70797996, -93.29999855],\n",
       "       [ 61.70798025, -93.29999868],\n",
       "       [ 41.09478502, -94.9403424 ],\n",
       "       [ 41.09478453, -94.94034234],\n",
       "       [ 41.09478453, -94.94034254],\n",
       "       [ 56.43126008, -91.59615303],\n",
       "       [ 56.43125939, -91.59615222],\n",
       "       [ 56.43125955, -91.59615288],\n",
       "       [ 41.23806175, -94.57808391],\n",
       "       [ 41.23806175, -94.57808369],\n",
       "       [ 41.23806195, -94.57808357],\n",
       "       [ 41.23806212, -94.57808425],\n",
       "       [ 41.238062  , -94.57808384],\n",
       "       [ 51.62378617, -90.67784064],\n",
       "       [ 51.6237865 , -90.67783985],\n",
       "       [ 58.16111726, -93.76152394],\n",
       "       [ 58.16111712, -93.76152367],\n",
       "       [ 50.94273923, -82.54071491],\n",
       "       [ 50.9427386 , -82.54071433],\n",
       "       [ 52.03840621, -92.44749121],\n",
       "       [ 52.03840687, -92.44749157],\n",
       "       [ 46.03590634, -88.69756469],\n",
       "       [ 46.03590665, -88.69756469],\n",
       "       [ 46.03590643, -88.69756464],\n",
       "       [ 40.99703288, -89.43819759],\n",
       "       [ 40.99703291, -89.43819708],\n",
       "       [ 61.43774624, -89.3550339 ],\n",
       "       [ 61.4377457 , -89.35503461],\n",
       "       [ 43.93047407, -94.99375648],\n",
       "       [ 43.93047418, -94.9937569 ],\n",
       "       [ 43.9304744 , -94.99375673],\n",
       "       [ 43.93047433, -94.99375682],\n",
       "       [ 43.93047399, -94.99375719],\n",
       "       [ 63.99819526, -92.50069507],\n",
       "       [ 63.99819565, -92.5006952 ],\n",
       "       [ 69.95068656, -92.19910324],\n",
       "       [ 69.95068666, -92.19910339],\n",
       "       [ 69.95068668, -92.19910333],\n",
       "       [ 69.95068646, -92.19910331],\n",
       "       [ 69.95068622, -92.19910374],\n",
       "       [ 60.3642731 , -92.87232868],\n",
       "       [ 60.36427299, -92.87232878],\n",
       "       [ 60.36427301, -92.87232909],\n",
       "       [ 45.42386734, -86.26667823],\n",
       "       [ 45.42386659, -86.2666777 ],\n",
       "       [ 47.24875731, -99.92821618],\n",
       "       [ 47.24875751, -99.92821528],\n",
       "       [ 56.65877441, -82.79695656],\n",
       "       [ 56.65877508, -82.79695688],\n",
       "       [ 56.65877458, -82.79695704],\n",
       "       [ 58.15637292, -83.50714083],\n",
       "       [ 58.1563722 , -83.50714091],\n",
       "       [ 58.15637284, -83.50714081],\n",
       "       [ 58.15637291, -83.50714139],\n",
       "       [ 44.64168231, -86.17574486],\n",
       "       [ 44.64168258, -86.17574529],\n",
       "       [ 44.64168261, -86.17574467],\n",
       "       [ 61.34832252, -83.47297349],\n",
       "       [ 61.34832226, -83.47297327],\n",
       "       [ 61.3483222 , -83.47297362],\n",
       "       [ 61.3483227 , -83.47297342],\n",
       "       [ 61.3483225 , -83.4729734 ],\n",
       "       [ 68.2049857 , -87.04281839],\n",
       "       [ 68.2049857 , -87.04281811],\n",
       "       [ 69.24235315, -81.12528523],\n",
       "       [ 69.24235353, -81.12528597],\n",
       "       [ 69.24235333, -81.12528576],\n",
       "       [ 69.2423536 , -81.12528605],\n",
       "       [ 69.24235335, -81.12528535],\n",
       "       [ 63.40564409, -84.09810646],\n",
       "       [ 63.40564418, -84.09810671],\n",
       "       [ 63.40564439, -84.09810711],\n",
       "       [ 63.40564412, -84.09810702],\n",
       "       [ 60.58422471, -80.76762432],\n",
       "       [ 60.5842246 , -80.76762509],\n",
       "       [ 60.58422486, -80.76762446],\n",
       "       [ 68.79452973, -93.37671862],\n",
       "       [ 68.79452963, -93.37671858],\n",
       "       [ 41.76390789, -82.305786  ],\n",
       "       [ 41.76390792, -82.30578639],\n",
       "       [ 40.29314747, -84.4352848 ],\n",
       "       [ 40.29314779, -84.43528485],\n",
       "       [ 40.29314774, -84.43528431],\n",
       "       [ 53.36044397, -90.53917907],\n",
       "       [ 53.36044432, -90.53917976],\n",
       "       [ 53.36044428, -90.53917885],\n",
       "       [ 53.36044384, -90.53917948]])"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "coords"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Number of clusters: 50\n"
     ]
    }
   ],
   "source": [
    "kms_per_radian = 6371.0088\n",
    "contact_radius = 0.001\n",
    "min_samples = 3\n",
    "epsilon = contact_radius / kms_per_radian\n",
    "db = DBSCAN(eps=epsilon, min_samples=min_samples, algorithm='ball_tree', metric='haversine').fit(np.radians(coords))\n",
    "cluster_labels = db.labels_\n",
    "num_clusters = len(set(cluster_labels))\n",
    "clusters = pd.Series([coords[cluster_labels == n] for n in range(num_clusters)])\n",
    "print('Number of clusters: {}'.format(num_clusters))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([ 0,  1, -1,  2, -1, -1,  3, -1, -1,  4,  5,  6,  7, -1, -1,  8,  9,\n",
       "       10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, -1, -1, 21, 22, -1, 23,\n",
       "       24, 25, 26, -1, 27, 28, -1, 29, 30, -1, -1, 31, 32, -1, 33, 34, 35,\n",
       "       36, 37, 38, 39, 40, 41, 42, -1, 43, -1, -1, 44, 45, 46, -1, 47, -1,\n",
       "       48,  0,  0,  0,  1,  1,  2,  2,  2,  2,  2,  3,  3,  3,  3,  4,  4,\n",
       "        4,  4,  5,  5,  6,  6,  7,  7,  7,  7,  8,  8,  8,  9,  9,  9,  9,\n",
       "        9, 10, 10, 10, 11, 11, 11, 11, 12, 12, 13, 13, 14, 14, 14, 15, 15,\n",
       "       16, 16, 16, 17, 17, 18, 18, 18, 18, 19, 19, 19, 19, 19, 20, 20, 20,\n",
       "       20, 20, 21, 21, 21, 22, 22, 22, 23, 23, 23, 23, 23, 24, 24, 25, 25,\n",
       "       26, 26, 27, 27, 28, 28, 28, 29, 29, 30, 30, 31, 31, 31, 31, 31, 32,\n",
       "       32, 33, 33, 33, 33, 33, 34, 34, 34, 35, 35, 36, 36, 37, 37, 37, 38,\n",
       "       38, 38, 38, 39, 39, 39, 40, 40, 40, 40, 40, 41, 41, 42, 42, 42, 42,\n",
       "       42, 43, 43, 43, 43, 44, 44, 44, 45, 45, 46, 46, 47, 47, 47, 48, 48,\n",
       "       48, 48], dtype=int64)"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "cluster_labels"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [],
   "source": [
    "def get_centermost_point(cluster):\n",
    "    centermost_point = None\n",
    "    if len(cluster) != 0:\n",
    "        centroid = (MultiPoint(cluster).centroid.x, MultiPoint(cluster).centroid.y)\n",
    "        centermost_point = min(cluster, key=lambda point: great_circle(point, centroid).m)\n",
    "    return tuple(centermost_point)\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [],
   "source": [
    "clusters = clusters[clusters.str.len() != 0]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Ignored points :  20\n"
     ]
    }
   ],
   "source": [
    "print(\"Ignored points : \" ,len(coords) - clusters.map(len).sum())"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0       (66.09553172283826, -80.4878876075996)\n",
       "1     (56.304469071887915, -89.77163561768762)\n",
       "2     (46.255378176734034, -89.17099438254341)\n",
       "3      (46.93993542758146, -97.42480099789199)\n",
       "4      (48.31701125657953, -91.44721096348718)\n",
       "5      (68.66558033811735, -89.24382310178802)\n",
       "6      (49.36116647344525, -97.43664734065246)\n",
       "7      (69.63186031046108, -98.95519113965598)\n",
       "8      (55.767503522194744, -91.5302970389868)\n",
       "9      (60.12897164446742, -96.77239532300759)\n",
       "10     (68.77728541614283, -87.53190760100082)\n",
       "11    (47.409285702031305, -93.10841187456285)\n",
       "12    (54.428467056867376, -92.29046453145318)\n",
       "13     (61.32159747775052, -82.40397285736395)\n",
       "14      (47.4239665623309, -82.67853182946742)\n",
       "15    (59.849213465066335, -94.79552317195801)\n",
       "16      (61.7472401160439, -89.77313033779527)\n",
       "17      (65.95126405147884, -97.6638813125745)\n",
       "18      (52.1232105181419, -86.79931711581015)\n",
       "19     (63.40266722217419, -83.23579574874222)\n",
       "20     (61.70798009223388, -93.29999820532227)\n",
       "21    (41.094784532023525, -94.94034253745325)\n",
       "22    (56.431259553954604, -91.59615288416961)\n",
       "23     (41.23806174851957, -94.57808390532026)\n",
       "24      (51.6237861713364, -90.67784063851128)\n",
       "25     (58.16111711920709, -93.76152367499404)\n",
       "26     (50.94273858146038, -82.54071530303726)\n",
       "27    (52.038406206850794, -92.44749120788266)\n",
       "28     (46.03590633794431, -88.69756469383536)\n",
       "29    (40.997032878772615, -89.43819758512402)\n",
       "30     (61.43774570238468, -89.35503460867507)\n",
       "31     (43.93047418483923, -94.99375689950682)\n",
       "32     (63.99819525904699, -92.50069507239753)\n",
       "33     (69.95068645684479, -92.19910331448538)\n",
       "34     (60.36427298960058, -92.87232877888373)\n",
       "35     (45.42386656596203, -86.26667860334652)\n",
       "36     (47.24875731120662, -99.92821618248453)\n",
       "37    (56.658774584685645, -82.79695703678225)\n",
       "38     (58.15637283570234, -83.50714081089491)\n",
       "39    (44.641682310803176, -86.17574485953317)\n",
       "40     (61.34832219612504, -83.47297362429025)\n",
       "41     (68.20498569627173, -87.04281839413798)\n",
       "42     (69.24235333122424, -81.12528576203204)\n",
       "43     (63.40564418377133, -84.09810671155456)\n",
       "44    (60.584224601850174, -80.76762509225523)\n",
       "45     (68.79452962604965, -93.37671858031362)\n",
       "46    (41.763907923483025, -82.30578639365046)\n",
       "47    (40.293147474054294, -84.43528480269248)\n",
       "48     (53.36044383835253, -90.53917948001218)\n",
       "dtype: object"
      ]
     },
     "execution_count": 14,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "centermost_points = clusters.map(get_centermost_point)\n",
    "centermost_points"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0       (66.09553172283826, -80.4878876075996)\n",
       "1     (56.304469071887915, -89.77163561768762)\n",
       "2     (46.255378176734034, -89.17099438254341)\n",
       "3      (46.93993542758146, -97.42480099789199)\n",
       "4      (48.31701125657953, -91.44721096348718)\n",
       "5      (68.66558033811735, -89.24382310178802)\n",
       "6      (49.36116647344525, -97.43664734065246)\n",
       "7      (69.63186031046108, -98.95519113965598)\n",
       "8      (55.767503522194744, -91.5302970389868)\n",
       "9      (60.12897164446742, -96.77239532300759)\n",
       "10     (68.77728541614283, -87.53190760100082)\n",
       "11    (47.409285702031305, -93.10841187456285)\n",
       "12    (54.428467056867376, -92.29046453145318)\n",
       "13     (61.32159747775052, -82.40397285736395)\n",
       "14      (47.4239665623309, -82.67853182946742)\n",
       "15    (59.849213465066335, -94.79552317195801)\n",
       "16      (61.7472401160439, -89.77313033779527)\n",
       "17      (65.95126405147884, -97.6638813125745)\n",
       "18      (52.1232105181419, -86.79931711581015)\n",
       "19     (63.40266722217419, -83.23579574874222)\n",
       "20     (61.70798009223388, -93.29999820532227)\n",
       "21    (41.094784532023525, -94.94034253745325)\n",
       "22    (56.431259553954604, -91.59615288416961)\n",
       "23     (41.23806174851957, -94.57808390532026)\n",
       "24      (51.6237861713364, -90.67784063851128)\n",
       "25     (58.16111711920709, -93.76152367499404)\n",
       "26     (50.94273858146038, -82.54071530303726)\n",
       "27    (52.038406206850794, -92.44749120788266)\n",
       "28     (46.03590633794431, -88.69756469383536)\n",
       "29    (40.997032878772615, -89.43819758512402)\n",
       "30     (61.43774570238468, -89.35503460867507)\n",
       "31     (43.93047418483923, -94.99375689950682)\n",
       "32     (63.99819525904699, -92.50069507239753)\n",
       "33     (69.95068645684479, -92.19910331448538)\n",
       "34     (60.36427298960058, -92.87232877888373)\n",
       "35     (45.42386656596203, -86.26667860334652)\n",
       "36     (47.24875731120662, -99.92821618248453)\n",
       "37    (56.658774584685645, -82.79695703678225)\n",
       "38     (58.15637283570234, -83.50714081089491)\n",
       "39    (44.641682310803176, -86.17574485953317)\n",
       "40     (61.34832219612504, -83.47297362429025)\n",
       "41     (68.20498569627173, -87.04281839413798)\n",
       "42     (69.24235333122424, -81.12528576203204)\n",
       "43     (63.40564418377133, -84.09810671155456)\n",
       "44    (60.584224601850174, -80.76762509225523)\n",
       "45     (68.79452962604965, -93.37671858031362)\n",
       "46    (41.763907923483025, -82.30578639365046)\n",
       "47    (40.293147474054294, -84.43528480269248)\n",
       "48     (53.36044383835253, -90.53917948001218)\n",
       "dtype: object"
      ]
     },
     "execution_count": 15,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "centermost_points.dropna()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array(['552', '437', '606', '898', '177', '681', '987', '921', '740',\n",
       "       '584', '202', '931', '279', '162', '389', '386', '108', '291',\n",
       "       '742', '169'], dtype=object)"
      ]
     },
     "execution_count": 16,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ndf['device_key'].unique()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "20"
      ]
     },
     "execution_count": 17,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "nodes = ndf['device_key'].unique()\n",
    "len(nodes)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "metadata": {},
   "outputs": [],
   "source": [
    "import networkx as nx"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "metadata": {},
   "outputs": [],
   "source": [
    "G = nx.Graph()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>unix_time</th>\n",
       "      <th>device_key</th>\n",
       "      <th>latitude</th>\n",
       "      <th>longitude</th>\n",
       "      <th>min_duration_seconds</th>\n",
       "      <th>dupl_idx</th>\n",
       "      <th>str_time</th>\n",
       "      <th>end_time</th>\n",
       "      <th>place_id</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>1607897553</td>\n",
       "      <td>552</td>\n",
       "      <td>66.095531</td>\n",
       "      <td>-80.487888</td>\n",
       "      <td>1</td>\n",
       "      <td>False</td>\n",
       "      <td>1607897553</td>\n",
       "      <td>1607897554</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>1607897554</td>\n",
       "      <td>552</td>\n",
       "      <td>56.304469</td>\n",
       "      <td>-89.771636</td>\n",
       "      <td>6</td>\n",
       "      <td>False</td>\n",
       "      <td>1607897554</td>\n",
       "      <td>1607897560</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>1607897555</td>\n",
       "      <td>552</td>\n",
       "      <td>69.680385</td>\n",
       "      <td>-97.546706</td>\n",
       "      <td>2</td>\n",
       "      <td>False</td>\n",
       "      <td>1607897555</td>\n",
       "      <td>1607897557</td>\n",
       "      <td>-1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>1607897556</td>\n",
       "      <td>437</td>\n",
       "      <td>46.255378</td>\n",
       "      <td>-89.170995</td>\n",
       "      <td>7</td>\n",
       "      <td>False</td>\n",
       "      <td>1607897556</td>\n",
       "      <td>1607897563</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>1607897557</td>\n",
       "      <td>437</td>\n",
       "      <td>57.704822</td>\n",
       "      <td>-92.932916</td>\n",
       "      <td>11</td>\n",
       "      <td>False</td>\n",
       "      <td>1607897557</td>\n",
       "      <td>1607897568</td>\n",
       "      <td>-1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>218</td>\n",
       "      <td>1607897633</td>\n",
       "      <td>681</td>\n",
       "      <td>40.293148</td>\n",
       "      <td>-84.435284</td>\n",
       "      <td>20</td>\n",
       "      <td>66</td>\n",
       "      <td>1607897622</td>\n",
       "      <td>1607897642</td>\n",
       "      <td>47</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>219</td>\n",
       "      <td>1607897633</td>\n",
       "      <td>584</td>\n",
       "      <td>53.360444</td>\n",
       "      <td>-90.539179</td>\n",
       "      <td>3</td>\n",
       "      <td>68</td>\n",
       "      <td>1607897622</td>\n",
       "      <td>1607897625</td>\n",
       "      <td>48</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>220</td>\n",
       "      <td>1607897629</td>\n",
       "      <td>740</td>\n",
       "      <td>53.360444</td>\n",
       "      <td>-90.539180</td>\n",
       "      <td>1</td>\n",
       "      <td>68</td>\n",
       "      <td>1607897623</td>\n",
       "      <td>1607897624</td>\n",
       "      <td>48</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>221</td>\n",
       "      <td>1607897643</td>\n",
       "      <td>162</td>\n",
       "      <td>53.360444</td>\n",
       "      <td>-90.539179</td>\n",
       "      <td>7</td>\n",
       "      <td>68</td>\n",
       "      <td>1607897624</td>\n",
       "      <td>1607897631</td>\n",
       "      <td>48</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>222</td>\n",
       "      <td>1607897634</td>\n",
       "      <td>921</td>\n",
       "      <td>53.360444</td>\n",
       "      <td>-90.539179</td>\n",
       "      <td>4</td>\n",
       "      <td>68</td>\n",
       "      <td>1607897625</td>\n",
       "      <td>1607897629</td>\n",
       "      <td>48</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>223 rows × 9 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "      unix_time device_key   latitude  longitude min_duration_seconds  \\\n",
       "0    1607897553        552  66.095531 -80.487888                    1   \n",
       "1    1607897554        552  56.304469 -89.771636                    6   \n",
       "2    1607897555        552  69.680385 -97.546706                    2   \n",
       "3    1607897556        437  46.255378 -89.170995                    7   \n",
       "4    1607897557        437  57.704822 -92.932916                   11   \n",
       "..          ...        ...        ...        ...                  ...   \n",
       "218  1607897633        681  40.293148 -84.435284                   20   \n",
       "219  1607897633        584  53.360444 -90.539179                    3   \n",
       "220  1607897629        740  53.360444 -90.539180                    1   \n",
       "221  1607897643        162  53.360444 -90.539179                    7   \n",
       "222  1607897634        921  53.360444 -90.539179                    4   \n",
       "\n",
       "    dupl_idx    str_time    end_time  place_id  \n",
       "0      False  1607897553  1607897554         0  \n",
       "1      False  1607897554  1607897560         1  \n",
       "2      False  1607897555  1607897557        -1  \n",
       "3      False  1607897556  1607897563         2  \n",
       "4      False  1607897557  1607897568        -1  \n",
       "..       ...         ...         ...       ...  \n",
       "218       66  1607897622  1607897642        47  \n",
       "219       68  1607897622  1607897625        48  \n",
       "220       68  1607897623  1607897624        48  \n",
       "221       68  1607897624  1607897631        48  \n",
       "222       68  1607897625  1607897629        48  \n",
       "\n",
       "[223 rows x 9 columns]"
      ]
     },
     "execution_count": 20,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df['place_id'] = cluster_labels\n",
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>unix_time</th>\n",
       "      <th>device_key</th>\n",
       "      <th>latitude</th>\n",
       "      <th>longitude</th>\n",
       "      <th>min_duration_seconds</th>\n",
       "      <th>dupl_idx</th>\n",
       "      <th>str_time</th>\n",
       "      <th>end_time</th>\n",
       "      <th>place_id</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>1607897556</td>\n",
       "      <td>437</td>\n",
       "      <td>46.255378</td>\n",
       "      <td>-89.170995</td>\n",
       "      <td>7</td>\n",
       "      <td>False</td>\n",
       "      <td>1607897556</td>\n",
       "      <td>1607897563</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>74</td>\n",
       "      <td>1607897567</td>\n",
       "      <td>202</td>\n",
       "      <td>46.255378</td>\n",
       "      <td>-89.170994</td>\n",
       "      <td>21</td>\n",
       "      <td>3</td>\n",
       "      <td>1607897557</td>\n",
       "      <td>1607897578</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>75</td>\n",
       "      <td>1607897565</td>\n",
       "      <td>606</td>\n",
       "      <td>46.255378</td>\n",
       "      <td>-89.170994</td>\n",
       "      <td>7</td>\n",
       "      <td>3</td>\n",
       "      <td>1607897558</td>\n",
       "      <td>1607897565</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>76</td>\n",
       "      <td>1607897565</td>\n",
       "      <td>898</td>\n",
       "      <td>46.255378</td>\n",
       "      <td>-89.170994</td>\n",
       "      <td>8</td>\n",
       "      <td>3</td>\n",
       "      <td>1607897559</td>\n",
       "      <td>1607897567</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>77</td>\n",
       "      <td>1607897560</td>\n",
       "      <td>921</td>\n",
       "      <td>46.255379</td>\n",
       "      <td>-89.170994</td>\n",
       "      <td>23</td>\n",
       "      <td>3</td>\n",
       "      <td>1607897560</td>\n",
       "      <td>1607897583</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>78</td>\n",
       "      <td>1607897562</td>\n",
       "      <td>202</td>\n",
       "      <td>46.255378</td>\n",
       "      <td>-89.170994</td>\n",
       "      <td>13</td>\n",
       "      <td>3</td>\n",
       "      <td>1607897561</td>\n",
       "      <td>1607897574</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "     unix_time device_key   latitude  longitude min_duration_seconds dupl_idx  \\\n",
       "3   1607897556        437  46.255378 -89.170995                    7    False   \n",
       "74  1607897567        202  46.255378 -89.170994                   21        3   \n",
       "75  1607897565        606  46.255378 -89.170994                    7        3   \n",
       "76  1607897565        898  46.255378 -89.170994                    8        3   \n",
       "77  1607897560        921  46.255379 -89.170994                   23        3   \n",
       "78  1607897562        202  46.255378 -89.170994                   13        3   \n",
       "\n",
       "      str_time    end_time  place_id  \n",
       "3   1607897556  1607897563         2  \n",
       "74  1607897557  1607897578         2  \n",
       "75  1607897558  1607897565         2  \n",
       "76  1607897559  1607897567         2  \n",
       "77  1607897560  1607897583         2  \n",
       "78  1607897561  1607897574         2  "
      ]
     },
     "execution_count": 21,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df[df.place_id == 2]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "metadata": {},
   "outputs": [],
   "source": [
    "def get_overlap(s1,e1,s2,e2):\n",
    "    return min(e1,e2) - max(s1,s2)\n",
    "\n",
    "overlap_threshold = 15\n",
    "device_keys = set(df[df.place_id == 2])\n",
    "df2 = df\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "metadata": {},
   "outputs": [],
   "source": [
    "graphdf = pd.DataFrame(columns=['node1','node2','overlap','place_id',])\n",
    "\n",
    "# Conditional Self join is not possible in pandas \n",
    "for index1,row1 in df.iterrows():\n",
    "    for index2,row2 in df[(df.place_id == row1.place_id) & (df.index > index1) & (df.device_key != row1.device_key) ].iterrows():\n",
    "        overlap = min(row1.end_time,row2.end_time) - max(row1.str_time,row2.str_time)\n",
    "        if(overlap > overlap_threshold):\n",
    "            graphdf=graphdf.append({'node1':row1.device_key,'node2':row2.device_key,'overlap':overlap,'place_id':row2.place_id},ignore_index=True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>node1</th>\n",
       "      <th>node2</th>\n",
       "      <th>overlap</th>\n",
       "      <th>place_id</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>987</td>\n",
       "      <td>584</td>\n",
       "      <td>18</td>\n",
       "      <td>11</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>921</td>\n",
       "      <td>740</td>\n",
       "      <td>21</td>\n",
       "      <td>16</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>921</td>\n",
       "      <td>742</td>\n",
       "      <td>19</td>\n",
       "      <td>16</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>921</td>\n",
       "      <td>108</td>\n",
       "      <td>18</td>\n",
       "      <td>16</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>740</td>\n",
       "      <td>931</td>\n",
       "      <td>22</td>\n",
       "      <td>19</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>5</td>\n",
       "      <td>740</td>\n",
       "      <td>921</td>\n",
       "      <td>19</td>\n",
       "      <td>20</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>6</td>\n",
       "      <td>386</td>\n",
       "      <td>291</td>\n",
       "      <td>19</td>\n",
       "      <td>39</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>7</td>\n",
       "      <td>291</td>\n",
       "      <td>389</td>\n",
       "      <td>19</td>\n",
       "      <td>46</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>8</td>\n",
       "      <td>202</td>\n",
       "      <td>921</td>\n",
       "      <td>18</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>9</td>\n",
       "      <td>740</td>\n",
       "      <td>742</td>\n",
       "      <td>19</td>\n",
       "      <td>16</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>10</td>\n",
       "      <td>740</td>\n",
       "      <td>108</td>\n",
       "      <td>18</td>\n",
       "      <td>16</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>11</td>\n",
       "      <td>742</td>\n",
       "      <td>108</td>\n",
       "      <td>18</td>\n",
       "      <td>16</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>12</td>\n",
       "      <td>921</td>\n",
       "      <td>681</td>\n",
       "      <td>16</td>\n",
       "      <td>18</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>13</td>\n",
       "      <td>921</td>\n",
       "      <td>386</td>\n",
       "      <td>19</td>\n",
       "      <td>20</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>14</td>\n",
       "      <td>108</td>\n",
       "      <td>291</td>\n",
       "      <td>18</td>\n",
       "      <td>21</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>15</td>\n",
       "      <td>108</td>\n",
       "      <td>177</td>\n",
       "      <td>16</td>\n",
       "      <td>21</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>16</td>\n",
       "      <td>291</td>\n",
       "      <td>177</td>\n",
       "      <td>16</td>\n",
       "      <td>21</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>17</td>\n",
       "      <td>740</td>\n",
       "      <td>177</td>\n",
       "      <td>20</td>\n",
       "      <td>41</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>18</td>\n",
       "      <td>931</td>\n",
       "      <td>987</td>\n",
       "      <td>20</td>\n",
       "      <td>42</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>19</td>\n",
       "      <td>931</td>\n",
       "      <td>921</td>\n",
       "      <td>19</td>\n",
       "      <td>42</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>20</td>\n",
       "      <td>987</td>\n",
       "      <td>921</td>\n",
       "      <td>19</td>\n",
       "      <td>42</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>21</td>\n",
       "      <td>108</td>\n",
       "      <td>437</td>\n",
       "      <td>21</td>\n",
       "      <td>44</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   node1 node2 overlap place_id\n",
       "0    987   584      18       11\n",
       "1    921   740      21       16\n",
       "2    921   742      19       16\n",
       "3    921   108      18       16\n",
       "4    740   931      22       19\n",
       "5    740   921      19       20\n",
       "6    386   291      19       39\n",
       "7    291   389      19       46\n",
       "8    202   921      18        2\n",
       "9    740   742      19       16\n",
       "10   740   108      18       16\n",
       "11   742   108      18       16\n",
       "12   921   681      16       18\n",
       "13   921   386      19       20\n",
       "14   108   291      18       21\n",
       "15   108   177      16       21\n",
       "16   291   177      16       21\n",
       "17   740   177      20       41\n",
       "18   931   987      20       42\n",
       "19   931   921      19       42\n",
       "20   987   921      19       42\n",
       "21   108   437      21       44"
      ]
     },
     "execution_count": 24,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "graphdf"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "metadata": {},
   "outputs": [],
   "source": [
    "graphdf = graphdf.drop_duplicates(subset=['node1','node2','place_id'],keep='last')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>node1</th>\n",
       "      <th>node2</th>\n",
       "      <th>overlap</th>\n",
       "      <th>place_id</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>987</td>\n",
       "      <td>584</td>\n",
       "      <td>18</td>\n",
       "      <td>11</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>921</td>\n",
       "      <td>740</td>\n",
       "      <td>21</td>\n",
       "      <td>16</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>921</td>\n",
       "      <td>742</td>\n",
       "      <td>19</td>\n",
       "      <td>16</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>921</td>\n",
       "      <td>108</td>\n",
       "      <td>18</td>\n",
       "      <td>16</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>740</td>\n",
       "      <td>931</td>\n",
       "      <td>22</td>\n",
       "      <td>19</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>5</td>\n",
       "      <td>740</td>\n",
       "      <td>921</td>\n",
       "      <td>19</td>\n",
       "      <td>20</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>6</td>\n",
       "      <td>386</td>\n",
       "      <td>291</td>\n",
       "      <td>19</td>\n",
       "      <td>39</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>7</td>\n",
       "      <td>291</td>\n",
       "      <td>389</td>\n",
       "      <td>19</td>\n",
       "      <td>46</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>8</td>\n",
       "      <td>202</td>\n",
       "      <td>921</td>\n",
       "      <td>18</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>9</td>\n",
       "      <td>740</td>\n",
       "      <td>742</td>\n",
       "      <td>19</td>\n",
       "      <td>16</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>10</td>\n",
       "      <td>740</td>\n",
       "      <td>108</td>\n",
       "      <td>18</td>\n",
       "      <td>16</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>11</td>\n",
       "      <td>742</td>\n",
       "      <td>108</td>\n",
       "      <td>18</td>\n",
       "      <td>16</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>12</td>\n",
       "      <td>921</td>\n",
       "      <td>681</td>\n",
       "      <td>16</td>\n",
       "      <td>18</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>13</td>\n",
       "      <td>921</td>\n",
       "      <td>386</td>\n",
       "      <td>19</td>\n",
       "      <td>20</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>14</td>\n",
       "      <td>108</td>\n",
       "      <td>291</td>\n",
       "      <td>18</td>\n",
       "      <td>21</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>15</td>\n",
       "      <td>108</td>\n",
       "      <td>177</td>\n",
       "      <td>16</td>\n",
       "      <td>21</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>16</td>\n",
       "      <td>291</td>\n",
       "      <td>177</td>\n",
       "      <td>16</td>\n",
       "      <td>21</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>17</td>\n",
       "      <td>740</td>\n",
       "      <td>177</td>\n",
       "      <td>20</td>\n",
       "      <td>41</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>18</td>\n",
       "      <td>931</td>\n",
       "      <td>987</td>\n",
       "      <td>20</td>\n",
       "      <td>42</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>19</td>\n",
       "      <td>931</td>\n",
       "      <td>921</td>\n",
       "      <td>19</td>\n",
       "      <td>42</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>20</td>\n",
       "      <td>987</td>\n",
       "      <td>921</td>\n",
       "      <td>19</td>\n",
       "      <td>42</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>21</td>\n",
       "      <td>108</td>\n",
       "      <td>437</td>\n",
       "      <td>21</td>\n",
       "      <td>44</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   node1 node2 overlap place_id\n",
       "0    987   584      18       11\n",
       "1    921   740      21       16\n",
       "2    921   742      19       16\n",
       "3    921   108      18       16\n",
       "4    740   931      22       19\n",
       "5    740   921      19       20\n",
       "6    386   291      19       39\n",
       "7    291   389      19       46\n",
       "8    202   921      18        2\n",
       "9    740   742      19       16\n",
       "10   740   108      18       16\n",
       "11   742   108      18       16\n",
       "12   921   681      16       18\n",
       "13   921   386      19       20\n",
       "14   108   291      18       21\n",
       "15   108   177      16       21\n",
       "16   291   177      16       21\n",
       "17   740   177      20       41\n",
       "18   931   987      20       42\n",
       "19   931   921      19       42\n",
       "20   987   921      19       42\n",
       "21   108   437      21       44"
      ]
     },
     "execution_count": 26,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "graphdf"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 27,
   "metadata": {},
   "outputs": [],
   "source": [
    "import networkx as nx\n",
    "G = nx.Graph()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 28,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0     [[66.09553125344267, -80.48788822184089], [66....\n",
       "1     [[56.30446897762444, -89.77163620522992], [56....\n",
       "2     [[46.25537765335525, -89.17099478948056], [46....\n",
       "3     [[46.939934972564885, -97.4248011277028], [46....\n",
       "4     [[48.317010657138034, -91.44721127200202], [48...\n",
       "5     [[68.6655799027421, -89.2438231239262], [68.66...\n",
       "6     [[49.36116647190814, -97.43664811070543], [49....\n",
       "7     [[69.63185989056731, -98.95519125206343], [69....\n",
       "8     [[55.767503123352434, -91.5302975556787], [55....\n",
       "9     [[60.12897147052702, -96.77239570483383], [60....\n",
       "10    [[68.77728485290706, -87.53190831564798], [68....\n",
       "11    [[47.40928549418557, -93.10841229192364], [47....\n",
       "12    [[54.428466791276286, -92.29046507099673], [54...\n",
       "13    [[61.32159734630038, -82.40397324016581], [61....\n",
       "14    [[47.42396618348471, -82.67853211380785], [47....\n",
       "15    [[59.849212686776184, -94.79552405835813], [59...\n",
       "16    [[61.747239801732896, -89.773130446531], [61.7...\n",
       "17    [[65.95126366509388, -97.66388154142113], [65....\n",
       "18    [[52.12320987140645, -86.7993173478801], [52.1...\n",
       "19    [[63.402667103833096, -83.23579590637183], [63...\n",
       "20    [[61.70797963413517, -93.29999873275585], [61....\n",
       "21    [[41.09478404258817, -94.94034312065521], [41....\n",
       "22    [[56.431259231439995, -91.59615305608621], [56...\n",
       "23    [[41.23806117407744, -94.57808445598046], [41....\n",
       "24    [[51.62378601942582, -90.67784072472776], [51....\n",
       "25    [[58.161116668987475, -93.7615246692467], [58....\n",
       "26    [[50.94273858146038, -82.54071530303726], [50....\n",
       "27    [[52.03840593299893, -92.44749216567381], [52....\n",
       "28    [[46.0359060305834, -88.69756561027458], [46.0...\n",
       "29    [[40.99703196836039, -89.43819774224653], [40....\n",
       "30    [[61.43774563634319, -89.3550347154993], [61.4...\n",
       "31    [[43.930473649605766, -94.99375722735928], [43...\n",
       "32    [[63.99819507538609, -92.50069561101787], [63....\n",
       "33    [[69.95068585022202, -92.19910399641472], [69....\n",
       "34    [[60.3642727076646, -92.87232911208746], [60.3...\n",
       "35    [[45.42386656596203, -86.26667860334652], [45....\n",
       "36    [[47.248757164325056, -99.92821620603088], [47...\n",
       "37    [[56.658774124301274, -82.79695753603333], [56...\n",
       "38    [[58.15637205342794, -83.50714178485565], [58....\n",
       "39    [[44.641682000528235, -86.17574551578299], [44...\n",
       "40    [[61.34832177570274, -83.4729740928413], [61.3...\n",
       "41    [[68.2049854628347, -87.04281843261819], [68.2...\n",
       "42    [[69.24235287842191, -81.1252861819712], [69.2...\n",
       "43    [[63.405644069280925, -84.0981071159519], [63....\n",
       "44    [[60.58422412560083, -80.76762530340255], [60....\n",
       "45    [[68.79452934860899, -93.37671948924822], [68....\n",
       "46    [[41.7639070795448, -82.3057865789268], [41.76...\n",
       "47    [[40.293147119526374, -84.43528490066902], [40...\n",
       "48    [[53.36044357984986, -90.53917977194392], [53....\n",
       "dtype: object"
      ]
     },
     "execution_count": 28,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "clusters"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 36,
   "metadata": {},
   "outputs": [],
   "source": [
    "weights = clusters.map(len)\n",
    "weights\n",
    "for idx,row in graphdf.iterrows():\n",
    "    G.add_edge(row.node1,row.node2,weight=weights[row.place_id])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 62,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "iVBORw0KGgoAAAANSUhEUgAAAWQAAADuCAYAAAAOR30qAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADl0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uIDIuMi4yLCBodHRwOi8vbWF0cGxvdGxpYi5vcmcvhp/UCwAAIABJREFUeJzt3Xd8U/X+x/FXmqR7QRctLRQoWChLhiIiUwQLiiIqInKdiKKA8wcyVRCRi4DKUHBdQMSLyBVB2XsJCBRKyx4tdO+ZZpzfH7WB2Bba0jQpfJ6PRx82yTkn31PLu998p0pRFIQQQtieg60LIIQQopgEshBC2AkJZCGEsBMSyEIIYSckkIUQwk5IIAshhJ2QQBZCCDshgSyEEHZCAlkIIeyEpjIH+/r6KqGhoVYqihBC3JoOHTqUqiiK342Oq1Qgh4aGcvDgwaqXSgghbkMqlepiRY6TJgshhLATEshCCGEnJJCFEMJOVKoNWYjqkJqrY+WheGITs8kuNODprCG8niePtw/Gx93J1sUTwmYkkEWNORqXybxtZ9h+KgUAncFkfs1Zk8jsTafofocfr3YLo02It62KKYTNSCCLGrF03wWmrYul0GCkrD0RCv8O5w0nkthxKpXxkeEM7RRas4UUwsYkkIXVFYdxDAV60w2PVRQo0BuZti4GQEJZ3FakU09Y1dG4TKati61QGF+rQG9i2rpYouIzrVQyIeyP1JCFVc3bdoac5EtcXvwabuH34vvQ2xRejCJ905cYslNRqRxwComg7gMj0Hj4AnBl8asYspIBaP+JCsVQxIMPPsiaNWtseStCWJ0EsrCa1Fwd20+lkLZ+IU6BTc3Pa31D8H/iAzQePigGPZk7l5C+fj7+gyYBEPTifPOxjmoVRctG8vjjj9d4+YWoaRLIwmpWHoonO3o7Ds5uaH3CMWQmAKB2q2N5oMoBQ0ZCmdcovHSc5KRkHnvsMWsXVwibk0AWVnP03BVSty0h4Klp5B7dYPGaISuZK9+8jqLLBwcHfPq+XuY10o9spHHHXri5udVEkYWwKQlkYTXbl8/Dvc0DaDxLL3Kl8fKnwRsrMBbkkHt0PVqf4FLHmPSF5J/cTegbn9ZEcYWwORllIaziyJEjJMUcwLPjgOsep3bxwL1lL5J/nopiMlq8ln9yLw7OHjRre7c1iyqE3ZAasrCKbdu2kZuaQNb851FQUIoKQTGRkDqawOfmWhyrmIyY8jMx6fJRu3iYn887vhnv1r1oHuRZ08UXwiYkkIVVDB8+nN4PPcrDX+yiyKCQ/ecqDFlJ1O0zkvyTe9D6NkBTNwhTQQ4ZWxbjGNDEIowN2akUXoyiXuTrDGpXujlDiFuRBLKwCldXVyKaNKRXuxQ2xiSh0jqj0jiidvXCkJNG+pavMeVnonJ0wblBK/wGjrc4Py96C071w+lzT2tZcEjcNlRKWQsLlKNDhw6K7BgiKuNoXCaDF+2jQG+88cH/4KJVs2J4J1oHy0JDonZTqVSHFEXpcKPjpFNPWFWbEG/GR4bjoq3cr5qL1oHxkeESxuK2Ik0WwupKFgi63mpvJVQqcNaoZbU3cVuSQBY1YminUFoHezN/2xm2nkxBxdUlNwGcNQ4oQI87/Hi1e5jUjMVtSQJZ1JjWwd4sHNqBtFwdK/+KZ/uRMxyOjqVvz26EB3owqJ3sGCJubxLIosb5uDvxctcmNCk6z8e/rmH2l6NtXSQh7IJ06gmb0ev1aDRSJxCihASysBmDwYBWq7V1MYSwGxLIwmakhiyEJQlkYTNSQxbCkgSysBmpIQthSQJZ2IzUkIWwJIEsbEZqyEJYkkAWNmMwGCSQhbiGBLKwGWmyEMKSBLKwGWmyEMKSBLKwGakhC2FJAlnYjNSQhbAkgSxsRmrIQliSQBY2IzVkISxJIAubkRqyEJYkkIXNSA1ZCEsSyMJmZGKIEJYkkIXNSJOFEJYkkIXNSJOFEJYkkIXNSA1ZCEsSyMJmpIYshCUJZGEzUkMWwpIEsrAZqSELYUkCWdiM1JCFsCSBLGxGashCWJJAFjYjE0OEsCSBLGxGmiyEsCSBLGxGmiyEsCT/GoTN1IYacmqujpWH4olNzCa70ICns4bwep483j4YH3cnWxdP3GIkkIXN2HMN+WhcJvO2nWH7qRQAdAaT+TVnTSKzN52i+x1+vNotjDYh3rYqprjF2Oe/BnFbsNca8tJ9F5i2LpZCgxFFKf164d/hvOFEEjtOpTI+MpyhnUJrtpDiliSBLGpcSTNAdsSjTN+dQf3Th+2mGaA4jGMo0JtueKyiQIHeyLR1MQASyuKmqZSyqgDl6NChg3Lw4EErFkfcyq7fDOCAAjZtBjgal8ngRfso0Bsrfa6LVs2K4Z1oHSzNF6I0lUp1SFGUDjc6TmrIokbYczPAF198wXfffcfho1G4NO+Kb783AMiN3kr6H/OuHqgoKAYd9Z6dg1O9MJJ+mowuLtr88p0fGWjRPJxjx47VSLnFrUcCWVidvTcDBAUFMeqt/2PUv7/DUKQzP+8e0QP3iB7mx7lRm8ja8yOOAU0ACHjifYvrJP8wjn4DHrF6ecWtSwJZVLuSGuexY8fo8/BjnG4+zBzGBReOkL5hIcbsFByDmuHb7w00Xv4AGAtySF8/n8KLRwEY+Us7Gv/0PZ2bN7BqeQcOHMjC7WdRu/xsEcj/lHt8M24te6JSqUq9ZshMoiAuGo9Wn1mzqMKK7GGIowSyqHZBQUFMmDCB9evXs/l4HPqmxW2yxvwsUn75CJ8HR+EadheZO5aS8r8ZBA6bBUDmjiWYCnOpP2IxKAopqz9ixJvjiPp9mdXLHJuYjeE63SmGrGR0cdH4RI4u8/Xc41twCm5BKtKGXNvY0xBHCWRR7QYOHAjAjj37SMo+Q52/gy7/1F4cfRvgFt4FAK8uQ8j5bAj6tDi0PiEYspJwbdYJBydXAFyb3sPZU3+SlqurUA1FURRyc3PJzs4mOzubrKws8/f/fPzP75PDB1732rnHN+MU3AKtd70yX887vgWvzk+SXaiv6I9J2AF769uQQBZWE5OQY/FYn3IRrX8j82MHR2c03vUoSrmE1icEj3b9yPlrLa4tugGQd3IP7k07MmbujzQ1Xrxh0Obk5ODi4oKnpydeXl54enqW+X1QUBDh4eEWz391rIhfTh0q917yjm/B654nynytMC4aY14GruH34ulsf+OqRdnssW9DAtmO2UOb1s1Iy9NhNF2tdpj0hahdvSyOcXByQykqACjuLDMaiJ/zFADOoW1wa9ef8xkphLroCQgIoFmzZuYQ/WfYenh4VHnmX5T+LGtUUNaAt8L4Exhz03G9494yz807vhnXZvfg6upGeKBHld5f1KyjcZlMWxdboTC+VoHexLR1sbQO9rbKEEcJZDtkT21alVFUVMTZs2eJjY0lNjaWS/EJFq87aJ0x6fItnjMV5aNydAEgdfXHaP0bEfLYREAhY8vXpK6ZRfuXJ/LuC4Px8LBO2BkMBroFazEaDaCYUAxF4KBG5aAGIO/YZlybdTY3pViUX68jL3Y3fo++h06vp5k2HWhilXKKmzd06FA2b95MWmYOiosXnp0ew6NNHwDyYnaSuWsZxpw0NB6+eHcbhmuzewBQDHoytn1HfuxOFIOOp/b05cjvy6t9pqkEsp2xtzatsmRkZJhD99qvixcv0qBBA8LDwwkPD8fDzZncgqujFrR+Dck7ttn82FRUiCEjEUe/4lEURcnnqfvAKzg4OgPgcWckiUvf5fjhA9Sr9yi+vr5ERERYfLVo0QI3N7cq30tOTg4DBgxg69at5ufyorfide9TeN/3NIqhiLzYXfg9Oq7M8wtO78PByRWXhq0Jdcxm2BMDady4MWPGjOHhhx9GrVZXuWyi+o0bN44Zc+fTc85ucpMukvjDOBwDmqB28yZ1zSz8H5uAc+P2FJw9SOrqj6n/yteo3bzJ2vdfihJPE/jCPFBMnPv5A96bNIWZ06dVa/kkkO2IPbVpmUwmLl26VGbw5uXlmUM3PDycYcOGER4eTlhYGE5OThgMBgwGA1EvjCEpNcNc43Rtdg8ZW78hL3Y3rmEdydq9HK1/KFqfEAAcA5uSe3QD3j2eAyDnyB84BTTirRcG8+I3Y7lw4QLR0dFER0ezadMm5s6dy8mTJwkICCgV1M2bN8fVtXSNtkRBQQHz58/nk08+4f777+fkyZMUuPiXmqmn0jjS4I0V5V7HrUU33Fp0w0WrZu7wSJpPfJxVq1Yxc+ZM3nzzTV5//XVeeOEFvLy8yr2GqDkREREs3H7270cqVKgwZCSAyYiDsxsuTYon07mGdUSldcKQmYDazZuCM3/i2WkQapfiT2l1Oj7M119/U+2BLFOnbcjd3d38vUkpDgmPOyOp+8AIi+Myd/1A1q4f8B88FZfQtgBkbPma/NP7MOZlovXwYdKE8YwfY3leReTn53Pq1KlSoXvq1Cl8fHwsgrfkKygoqMyxuCWmTJnC++9bTpooqXFeHYecjGPg3+OQvQMA0GcmkrHxS3SXYwEFx8Bm1HvwFQ7OeKbcNnOj0ci5c+fMQV3ydfr0aQIDA0sFdaNGjVi2bBkfffQRnTp14v3336dly5bm61Xmj2IJF60D4yObl/qjuH//fubOncsff/zB0KFDef3112natGmFryuso/UDT3B8668oBh2OAU0IePpjVBpHkpaPx/OuR3Fp0oGCM3+SvnEhQS99iYOjMwnfjsaz0yDcmt8HFM/iTFszi8zMzAr9sa3o1GkJZDvx3OKdfP/qA/g/PgXnBlcDQp+RQMqqqZgKcvDp/6Y5kDN3LsOtRVc0deujTzhN2sopbN34B507dy51bUVRSEpKKrO2m5SURFhYWKnQbdasWbW02f5r0S62n8kAh8rvhaBSQZ8WASwcesPf41IMBgNnz541B/SxY8fYs2cPV65cwcXFhY4dO9K5c2dzUIeHh+PsXNxUcqNmo2vL56xR37DZKD4+nvnz57No0SLuueceRo8eTc+eZU8wuZHa3tFrC4qikJ2dzZUrV0hISGDG3ixis9XoLsdSeOkYXp0GoVJryDm6gYxNX6EYilCptfg+MhbXsI4AZOxYgu5iFH6PTQCTieSfP6Qo4RRXrlwhMDDwhmWQQK5FUnN1tBzyHmk7lhE0YrHFP9Sknybj2b4/aesX4BM5yhzIpa7x84e8PWwATz0+kNjYWGJiYiyCV6PR0Lx581LBGxoaarV2zmPHjtF/2Ei0fd/GQOXfozoW7DEajSxfvpwpU6YQGhrK5MmT8fX1JTo6mhMnTpgD++zZs4SEhJgD2qtRK/4q9ONQog4Hrrbdw9WFkHrc4cer3cMqXL78/HyWLVvGnDlzcHBwYMyYMQwZMgQXF5cbnmvvCzPZgqIoZGVlkZCQYA7bsv575coV1Go1QUFBBAYGkttqEKnuxcMv0/74Aq1vA7S+DUhdPQP/Jz/AsV4TihLPkLLyQ/yfeB/HgMaY9Doyt35D/qm9qNRa3Nv2IXvXDxTpCiv070cCuRZZuP0sb/5rII7BEXjf97T5+bzYXeQd34r/oInEz3++3EA26XVcWfgCLg1aEVB0pcxmBl9f35q8JdavX88zzzzD3LlzMTa6h8mrozCqKh7K5TUDVJTJZGLVqlVMmjSJOnXqMHXqVHr06FHu8Xq9ntOnT5dq+riQmEZg50fxahCOq7cvft7utG3ox8sPtKFeHfdyr3c9iqKwadMm5syZw8GDBxk+fDivvPIKQUFBZR5f3TV2e1cStOWF67XPaTQaAgMDzWFb3n+v/bS3cPtZZm86hc5gIm3dZ6i0Tqg9/dDFn8D/sQnm45J/nopTcAu87i49aagwaj2uF3ZyLvpwhe5JVnurRf48fpKCS8ep8+Ao83OmogIyt3+P/5Mf3vD89PXz0Po35tkJn/L5kMp/vK9uX331FZMmTWLVqlV06dKFnTt3otu/HPcuw9AZTVYNFUVRWLt2LRMnTkStVvPpp5/Sp0+fGzYPaLVaWrRoQYsWLXj88cfNzxcVFXHq1KmrIb0/muXfRPPxsxdp1KhRqTbqpk2b3nAolEqlonfv3vTu3ZuTJ0/y2Wef0bJlSyIjIxkzZgwdOlz9f2hPHb03S1EUMjMzyw3Xa/+r1WpLhWqDBg3o1KmTxXPX9sPcSHJyMlu2bKFv9958usFIwbm/yIvZju9D7+Dg7Eb2vpUUJZ3DMaAxRYln0cVF49EuEgBDTiqgQu1el6IrJ0nbuZwvlnxb7T8jqSHbgXaPjeDEgd3Ue/pj83Ppmxfj4OSGd5fiSRLl1ZAztnxD4cWjBAyZTu82oXz9r441WvZrmUwmxo4dy+rVq1m7di1NmzYlPz+ftm3bMnPmTBq178b8bWfYejIFFdXTDFBCURQ2b97MhAkTyMvL48MPP2TAgAFVaqetCJ1Ox8mTJ0vVqOPi4mjcuHGpoA4LC7tuUGdkZPD111/z+eefU79+fZydnYk5eZrk1DTU3oHU6TbMPAIg5+h6sveuxJiXgVNwC3wiR6Px8AGg8GIUmbuXo086Sz0/Hy7HXbLK/V+rJGhvFLIJCQk4OjqaA7W82mxlg7aiUlJSGDRoEEePHiVfZwAPXzzaP4RH274AZB9aQ86BXzHmZ6J28cSjXT88/64dF146Tupvn2LKz0Lt6UvXJ15m84KJFX5vabKoReoENkR95yO4t3nA/NyVb17HmJNm7gwz5Wfj4OSKZ6dBeHUaBBR37OWf3E3A0x+jdvHk0bb1mf1k2W3M1lZQUMAzzzxDcnIyv/zyCz4+xQHxzjvvEB8fz/Lly83HpuXqWPlXPLEJOWQX6vF01hIe6MGgdlXrmNq5cycTJ04kISGB999/nyeeeAKHKnQiVofCwsIygzo+Pp6wsLBSQd2kSROL2YUGg4Eff/yR9957D2O7J9CEd6Xg7CFSf51J0PNfYMhOJmX1xwQ89RHaukGkb/oKfWqc+Y+57spJ9OmXwVCE7uDP5KRcqfK9KIpCRkbGDUM2ISEBJyenCjUd3MyY8epU05sRSJNFLbFnzx7yM1No0LIr1y5LE/DUNDBe/WVJ+P4N6vR6EZfG7QHI2vsTeSe2EfD0DNQunjhrHGw2bTcpKYkBAwYQFhbGxo0bcXIqDtX9+/ezZMmSUgu2+7g78XLXm5/NduDAASZOnMjJkyeZPHkyQ4cOtfmmqc7OzrRp04Y2bdpYPF9QUEBsbKw5oL/77juio6NJSEigadOmFiF99913c+BYLF0+2YreBK5hd6HxCkCXeIaiK7G4hnfB0a8hAF6dB3N53r/QZySgrROIU9AdOAXdQcGFIxTqjWUuzKQoCunp6TfsDEtISMDZ2blUqDZu3Jh7773XokZrL0FbUW1CvBkfGV7FIY7hVtsZRgLZxr7//nsGPPIIR51c4ZqP8GoXT8sDVQ44OLvj8Pc048zt/wG1hitfDjcfEucwDrpOqpFylzhx4gT9+/fnmWeeYcqUKeYmAp1Ox/PPP8/cuXPx8/Or1veMiopi0qRJHDx4kAkTJvD888/j6OhYre9R3VxcXLjzzju58847LZ7Pz88nJibGHNSLFy8mOjqa7Pp349F5MKi1GPMy0KdfxtGvAbrLMVg2whd/r0+5iLZO6eFXr8z8DwHpURZBm5iYiIuLS6kabOPGjenSpYtF0F5vck1tV9LGbk8dphLINvbll18CMHzJQTbGJJX7SxH86jcWjxuO/e3qA8VEj6Y+TH2h9Bhka9qyZQtPPfUUM2fOZNiwYRavTZ06lWbNmvHEE2WvkFYVsbGxTJkyhW3btjF27FiWL19eoSFj9szV1ZX27dvTvn17i+dfW3aA344noxgNpP76b9xb9ULrE4JLkw6k/u8TPO58EE2dILJ2/wioUAylF9ZXFEjSqbk3LIyuXbtaBHBt/7lVl6GdQmkd7G21vo3KkkC2EyO7h7HzdGqV2rTUKPzx6Rv84DKap556ymodWdf69ttvGTt2LCtWrKB79+4Wrx0+fJivvvqKI0eOVEtZzp07x/vvv8/vv//Om2++yeLFi63S6WNP8g2gKCZSf5sFag11exfPwnQJbYt3lyGk/PIRJl0+nh0HoHJyQf13p94/hTVvxWgbdvTWBq2DvVk4tEO1921UhQSynbi5Nq0Imj76GS+++CJLly5lwYIFNGzY0CrlVBSFiRMnsnz5crZv3054eLjF63q9nueff56ZM2dWaAbT9cTFxTF16lRWrlzJ66+/zunTp2+bNSE8nNSkrfsMY14m/o9PQaW++k/Vo31/PNr3B0CffpmsPSvQ+oWWeR1Zn7niqqtv42bYpitalGlop1DGRzbHRavmRhVLlaq4t7dk8sTdd9/NoUOHuPfee2nfvj2fffYZRmPla9vXU1hYyNNPP83mzZvZt29fqTAGmDFjBoGBgTzzzDNVfp/ExERGjx5N27ZtqVOnDqdOnWLKlCm3TRgDHP7h3xjT4/AfNAkH7dXamWIooijlAoqiYMhKJu33z/Ho8DBq5+JPDErJ8qFGAyoUmtR1pKioyFa3ISpJhr3Zoaj4zJtq04qNjeWll17CYDCwePFiIiIibrpMqampPPLIIwQFBfH999+X2QYZHR1N9+7d+euvvwgJCan0e6SlpfHJJ5+wePFihg0bxtixYwkICLjpstc2Fy9eJDQ0FJVaCw5XZzfW7TsS1yYdSVw2FkNmAipHF9xb3Y9312fMazcXXowiafl7Ftfr1q0b27Ztq8lbEP8g45BvASVtWlPmLKJ35MP4eLhWuE3LZDLx1VdfMXHiREaOHMm4cePMw9Eq69SpU/Tr149BgwYxbdq0Msf4GgwGOnfuzIsvvsjw4cPLuEr5MjMzmT17Nl988QVPPPEE48ePJzg4uEplvRWkp6czadIkVqf5owltB1S+Hf5mFmYS1a+igSxNFnaspE0r64/PWPBUG2Y/2ZaXuzapUAeDg4MDI0aM4PDhwxw+fJg777yTPXv2VLoMO3fupGvXrvzf//0f06dPL3fCxZw5c/Dw8OCll16q8LVzc3OZPn06TZs25dKlSxw4cIAFCxbctmFsNBpZuHAhzZs3R1EUfhj/L1y0VevmcdaoebV7WDWXUFibdOrVAjqdrsq12+DgYFavXs3KlSsZNGgQAwcOZPr06RVaWnPZsmW88cYbLFu2jN69e5d73KlTp/j444/5888/KzSqoqCggIULFzJjxgx69OjBrl27uOOOOyp1X7eanTt3MmrUKDw9PdmwYYN5Ysn4XMXuJi8I65Easp0r6Zi7mRloKpWKxx9/nOPHj1NQUEBERARr164t93hFUfjggw8YP348W7ZsuW4Ym0wmXnjhBSZNmkTjxo2vW46ioiLmz59PWFgYO3bsYMOGDSxfvvy2DuPLly8zZMgQhgwZwtixY9m2bZvFLL+b6egVtY/UkO2cTqertllodevW5euvv2bz5s0MHz7cvDavv7+/+ZiioiJeeuklTpw4wb59+6hXr951F0Vf/t0iFEXhtddeK/d9DQYD//nPf/jggw9o3rw5q1evpmPH23tsbGFhIbNnz2bWrFmMGDGCRYsWlTv92N4mLwjrkUC2czfTXFGeXr16cezYMSZPnkyrVq2YOXMmzzzzDJmZmQwcOBBvb2+2bdvGmXQ9k5YcLHf36083niT/TBrzZ8wrs23ZaDSyYsUKpkyZQlBQEEuXLqVLly7Vei+1jaIo/Pbbb7zxxhu0bNmS/fv306TJjce+2tPkBWE9MsrCziUlJdGqVSuSk5Otcv1Dhw7xwgsv4OnpSXx8PI8++iiffPIJyw/EVWiOPyi4aDUWc/wVReGXX35h0qRJeHh4MHXq1CpvWXQrOXnyJGPGjOH8+fPMnTuXPn362LpIoobY7WpvsidY5Vijhnyt9u3b8/nnnxMZGYmiKAQHB7Ns/yWm/xFbwY4klXlRdEUBn4wTTJw4EUVRmDFjBpGRkbd9EGdnZ/Phhx/y7bff8t577/Haa6/Z/WJIwjZqLJCvvydYIrM3nbrt9gSriKKiIqsG8k8//cSTTz6Js7MzDg4OvP3Ou5hMb1d492vFoCdt/TzyT+7m2VlO+Pj5s/DT6TzyyCM2W5PYXphMJpYsWcK4cePo27cvx48fp169erYulrBjNRLIN9oTrKSDYsOJJHacSq31e4JVp+rs1LtWSQ12/vz5HD58mLZtiwP2uUU7+H5kH1zDLdt69RkJ5J/cjdq9rsXzmbuWYci4Qv1Xv8WUm07Gfyfg6up624fxgQMHGDVqFEajkV9++YW7777b1kUStYDV/9Vc3RPsRm2RlnuCLd13wdpFqxWs0WSh1+sZPnw4K1asYO/eveYwTs3V8fua/6F29cIpxHK6dfrGhdTp/iw4WP4Nzzu+Ba97B6N2dkfr2wCXVg/w5WLLpUJvJ8nJybz44os8/PDDDB8+nH379kkYiwqzaiAfjctk2rqKtkVeVaA3MW1dLFHxmVYqWe1R3U0WWVlZREZGkpCQwI4dO6hfv775tZWH4smO2oRbS8sOuLzYXagcNLg0sRyqZizMxZibjqN/I/NzzgGN+fOvo9VW3tpCr9czZ84cIiIi8PLyIjY2lueee+62/6QgKsdqTRY//vgjr7w5jqzUBNRudfDpNwbnkJbkxewkc9cyjDlpaDx88e42DNdm9wBQlHKBjC1fU5R4FlNBNvObHbjt5+JXZ5PFxYsX6devH927d2fOnDmlJptUdvdrpagAAAenq+NnDRoXCnJyqqW8tcWmTZsYNWoUwcHB7Nixg+bNm9u6SKKWskogb9y4kXfefRePPm/gGRCGMTcdKN5KO3XNLPwfm4Bz4/YUnD1I6uqPqf/K16jdvFE5aHANvw+PO/uRsmoqW0+mlLkn2O2kuposDhw4wCOPPMK7777LqFGjyhz5cGTLrzgFt0DrfbXjKXPnMtwielo8V0L193ZSJl0+ao2j+XuN86277c+1zp8/z1tvvcWRI0eYPXs2Dz/88G0/okTcHKt8npo8eTLdB7+CS3A4KpUDGg9fNB6+GHPScHB2w6VJB1QqFa5hHVFpnTBkJgCg9QnGo80DaP0aAMVrXK38K94aRaw1ioqKbrqG/MsvvxAZGcn8+fMZPXp0uaFxfs/vuLfsafFc4cWj5BxRbT4LAAAfg0lEQVRaQ9znQ4n7fCjGnFRSV39M1r6VqJ3dUbvXpSj5vPl4ffJ5/EJsu8i3teXn5zN58mQ6dOhAu3btOHHiBAMGDJAwFjet2mvIRqORgwcPogrtwLnfP0cxFuHatBPePZ7HsV4YWp8Q8k/vx6VJBwrO/IlKo0Xr16jMaxUaTMQm3F4ff//pZmrIiqKYp+f+/vvvdOhQfvNPye7XwS26cO2y9jfa/dqtZU+y9qzAMbApprwMcqPWM2zSv6tUXnunKAorV67k7bff5p577uHIkSNVWvdZiPJUeyAnJSWh1+s5uXcjAUNnoHJQk/LzVLL2rKBOt2G4texJ6q8zUQxFqNRafB8Zi4Ojc7nXyy7UV3cRa5WqduoZDAZGjx7Njh072Lt3Lw0aNCj3WEVR+PDDD/Hw9MLoYLnlz412v/bu8jRp6+dxef5zqDRO+HQexORXnq50ee3dsWPHGDVqFGlpafznP/+hW7duti6SuAVVeyCX7CTR7sGnOPX3mFWPjo+QtWcFzg1bk7n1WwKGTMexXhOKEs+QsvJDNE+8j2NA2SuFJcWdZ+9eA61atbrlN7YsS1U69XJychg8eDAGg4Fdu3aVu/WRyWRi9erVTJ06Fb1ez7zP5rBJV59NsckV3v1apdHi228M9BtjXhT9VmrzT09PZ/LkyeY1OYYPH35TK+8JcT3V/ptVp04dgoODCfJ25aLawWJGXlHSOZxCInAKbAqAU2AzHIPuoODCkTIDWY2JgsSzvP76J5w4cYKgoCBat25N69atadOmDa1bt6ZRo0a39NCiyjZZxMfH079/f+666y7mzZuHVlt6k0uDwcBPP/3ERx99hIuLC5MnT+ahhx7CwcGB8LhMdp1Jq9Lu17fSouhGo5HFixczadIkBg4cSExMDD4+Ze/sLER1scqf+ueee441a3/E0O0tjIoDOQf/h2tYR5wCm5K9byVFSedwDGhMUeJZdHHReLSLBIo/OmPUoxgNADhgYsn7IwnyGYfBYODMmTNERUVx9OhRvvnmG6KiokhPT6dly5YWId2qVatbZkPMynTqHT58mIcffphRo0bx9ttvl+pk0uv1LFmyhOnTpxMQEMCsWbN44IEHLI67ud2v7WNR9JtdL2X37t28/vrruLm58ccff3DnnXfWQKmFsNJqb3q9ntGjR/P190swqDS4hd9HnR7PodI4kn1oDTkHfsWYn4naxROPdv3wvHsgAIbMJC4vfMHiWg0bNuTChQvlvldmZiZRUVEWX8ePH8fX19cipFu3bk1YWBhqtbrca9mjf//73yQkJDBr1qzrHrd27VqeffZZFixYwKBBgyxeKyws5Ntvv2XGjBk0bdqUCRMm0LVr1+uOCli67wIfrImmyGCC63wCUamKa8b2MN39+uulFK8ZfL31Ui5fvsy7777Ljh07+OSTTxg8eLCMnBDVwi42OT0al8ngRfuq9PHXRatmxfBOVapxmUwmzp49WyqoExMTiYiIMAd0yVfdunVvfNEaVlLLW7lxD/lGuKtty3JrefPmzWPatGmsWrWKTp06mZ/Py8vjq6++4t///jft2rVj/PjxFq/fSNdHhuLWcSDnCl3sflH0G62XUqKsPyA6nY7Zs2czc+ZMRowYwbhx427L/gphPXYRyHDtWhaV/fhb/dvQZGdnc/z4cXNAHz16lGPHjuHl5WUR0G3atKFZs2Y26bypTC2vZZAHb7/9Nn/88Qfr1q2jUaNG5vucN28ec+bM4b777mP8+PGV/tgdFRVF3759OX/+PLl67HpR9Kr+jr33YHPqpB1nzJgxRERE8Omnn1ZosXghKstuAhlurvZibSaTiYsXL1qEdFRUFPHx8YSHh5cKaj8/P6uVpTI/Jye1A75x23G89Cc///wzderUIT09nblz5zJv3jz69u3LuHHjiIiIKP9C1/Hss8/SrFkz3nvvvSreTc24mU9hKpMezbbP+fz9d+jbt68VSidEMbsKZICo+MxatSdYXl4e0dHR5oAu+XJ2di4V0uHh4Tc9m64qtTwHk4FJD7XkwabufPrppyxatIiBAwcyduxYwsKqPtrhypUrRERE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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "nx.draw_networkx(G)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 78,
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "{'987': 8.51586928150285,\n",
       " '584': 3.2003574278559563,\n",
       " '921': 19.940366060819898,\n",
       " '740': 10.52931385243848,\n",
       " '742': 5.903166808397174,\n",
       " '108': 11.989695342012944,\n",
       " '931': 8.325964180174463,\n",
       " '386': 5.377557308683922,\n",
       " '291': 8.563327012510019,\n",
       " '389': 2.527225183708882,\n",
       " '202': 3.4364951589768427,\n",
       " '681': 3.0423173943854644,\n",
       " '177': 5.878392167491279,\n",
       " '437': 2.769952821041822}"
      ]
     },
     "execution_count": 78,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "pr = nx.pagerank(G, alpha=0.85, weight='weight')\n",
    "{ k : 100*v for k,v in pr.items()}"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 81,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "{'552': 0,\n",
       " '437': 1,\n",
       " '606': 0,\n",
       " '898': 0,\n",
       " '177': 0,\n",
       " '681': 0,\n",
       " '987': 0,\n",
       " '921': 0,\n",
       " '740': 0,\n",
       " '584': 0,\n",
       " '202': 0,\n",
       " '931': 0,\n",
       " '279': 0,\n",
       " '162': 0,\n",
       " '389': 1,\n",
       " '386': 0,\n",
       " '108': 0,\n",
       " '291': 0,\n",
       " '742': 0,\n",
       " '169': 0}"
      ]
     },
     "execution_count": 81,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "personalization={n : 0 for n in nodes}\n",
    "personalization['389']=1\n",
    "personalization['437']=1\n",
    "personalization"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 82,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "{'987': 3.444446522050013,\n",
       " '584': 0.8610865813629573,\n",
       " '921': 12.583140796284633,\n",
       " '740': 8.027843734423781,\n",
       " '742': 4.6378749251512765,\n",
       " '108': 17.33786134862907,\n",
       " '931': 4.3058499120792595,\n",
       " '386': 4.811615640703562,\n",
       " '291': 14.643185511508438,\n",
       " '389': 9.98936280348501,\n",
       " '202': 1.492465236056883,\n",
       " '681': 1.2437210300474026,\n",
       " '177': 6.665368376028895,\n",
       " '437': 9.956177582188804}"
      ]
     },
     "execution_count": 82,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "pr = nx.pagerank(G, alpha=0.85,personalization=personalization, weight='weight')\n",
    "{ k : 100*v for k,v in pr.items()}"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 52,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>node1</th>\n",
       "      <th>node2</th>\n",
       "      <th>overlap</th>\n",
       "      <th>place_id</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>987</td>\n",
       "      <td>584</td>\n",
       "      <td>18</td>\n",
       "      <td>11</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>921</td>\n",
       "      <td>740</td>\n",
       "      <td>21</td>\n",
       "      <td>16</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>921</td>\n",
       "      <td>742</td>\n",
       "      <td>19</td>\n",
       "      <td>16</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>921</td>\n",
       "      <td>108</td>\n",
       "      <td>18</td>\n",
       "      <td>16</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>740</td>\n",
       "      <td>931</td>\n",
       "      <td>22</td>\n",
       "      <td>19</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>5</td>\n",
       "      <td>740</td>\n",
       "      <td>921</td>\n",
       "      <td>19</td>\n",
       "      <td>20</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>6</td>\n",
       "      <td>386</td>\n",
       "      <td>291</td>\n",
       "      <td>19</td>\n",
       "      <td>39</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>7</td>\n",
       "      <td>291</td>\n",
       "      <td>389</td>\n",
       "      <td>19</td>\n",
       "      <td>46</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>8</td>\n",
       "      <td>202</td>\n",
       "      <td>921</td>\n",
       "      <td>18</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>9</td>\n",
       "      <td>740</td>\n",
       "      <td>742</td>\n",
       "      <td>19</td>\n",
       "      <td>16</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>10</td>\n",
       "      <td>740</td>\n",
       "      <td>108</td>\n",
       "      <td>18</td>\n",
       "      <td>16</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>11</td>\n",
       "      <td>742</td>\n",
       "      <td>108</td>\n",
       "      <td>18</td>\n",
       "      <td>16</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>12</td>\n",
       "      <td>921</td>\n",
       "      <td>681</td>\n",
       "      <td>16</td>\n",
       "      <td>18</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>13</td>\n",
       "      <td>921</td>\n",
       "      <td>386</td>\n",
       "      <td>19</td>\n",
       "      <td>20</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>14</td>\n",
       "      <td>108</td>\n",
       "      <td>291</td>\n",
       "      <td>18</td>\n",
       "      <td>21</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>15</td>\n",
       "      <td>108</td>\n",
       "      <td>177</td>\n",
       "      <td>16</td>\n",
       "      <td>21</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>16</td>\n",
       "      <td>291</td>\n",
       "      <td>177</td>\n",
       "      <td>16</td>\n",
       "      <td>21</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>17</td>\n",
       "      <td>740</td>\n",
       "      <td>177</td>\n",
       "      <td>20</td>\n",
       "      <td>41</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>18</td>\n",
       "      <td>931</td>\n",
       "      <td>987</td>\n",
       "      <td>20</td>\n",
       "      <td>42</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>19</td>\n",
       "      <td>931</td>\n",
       "      <td>921</td>\n",
       "      <td>19</td>\n",
       "      <td>42</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>20</td>\n",
       "      <td>987</td>\n",
       "      <td>921</td>\n",
       "      <td>19</td>\n",
       "      <td>42</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>21</td>\n",
       "      <td>108</td>\n",
       "      <td>437</td>\n",
       "      <td>21</td>\n",
       "      <td>44</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   node1 node2 overlap place_id\n",
       "0    987   584      18       11\n",
       "1    921   740      21       16\n",
       "2    921   742      19       16\n",
       "3    921   108      18       16\n",
       "4    740   931      22       19\n",
       "5    740   921      19       20\n",
       "6    386   291      19       39\n",
       "7    291   389      19       46\n",
       "8    202   921      18        2\n",
       "9    740   742      19       16\n",
       "10   740   108      18       16\n",
       "11   742   108      18       16\n",
       "12   921   681      16       18\n",
       "13   921   386      19       20\n",
       "14   108   291      18       21\n",
       "15   108   177      16       21\n",
       "16   291   177      16       21\n",
       "17   740   177      20       41\n",
       "18   931   987      20       42\n",
       "19   931   921      19       42\n",
       "20   987   921      19       42\n",
       "21   108   437      21       44"
      ]
     },
     "execution_count": 52,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "graphdf"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 93,
   "metadata": {},
   "outputs": [
    {
     "ename": "TypeError",
     "evalue": "betweenness_centrality() got an unexpected keyword argument 'distance'",
     "output_type": "error",
     "traceback": [
      "\u001b[1;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[1;31mTypeError\u001b[0m                                 Traceback (most recent call last)",
      "\u001b[1;32m<ipython-input-93-79aad47d8126>\u001b[0m in \u001b[0;36m<module>\u001b[1;34m\u001b[0m\n\u001b[1;32m----> 1\u001b[1;33m \u001b[0mhc\u001b[0m \u001b[1;33m=\u001b[0m \u001b[0mnx\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mbetweenness_centrality\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mG\u001b[0m\u001b[1;33m,\u001b[0m\u001b[0mdistance\u001b[0m\u001b[1;33m=\u001b[0m\u001b[1;34m'weight'\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0m\u001b[0;32m      2\u001b[0m \u001b[1;33m{\u001b[0m\u001b[0mk\u001b[0m\u001b[1;33m:\u001b[0m\u001b[0mv\u001b[0m\u001b[1;33m/\u001b[0m\u001b[0mlen\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mbc\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mkeys\u001b[0m\u001b[1;33m(\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m)\u001b[0m \u001b[1;32mfor\u001b[0m \u001b[0mk\u001b[0m\u001b[1;33m,\u001b[0m\u001b[0mv\u001b[0m \u001b[1;32min\u001b[0m \u001b[0mbc\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mitems\u001b[0m\u001b[1;33m(\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m}\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n",
      "\u001b[1;31mTypeError\u001b[0m: betweenness_centrality() got an unexpected keyword argument 'distance'"
     ]
    }
   ],
   "source": [
    "hc = nx.betweenness_centrality(G,distance='weight')\n",
    "{k:v/len(bc.keys()) for k,v in bc.items()}"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 94,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "{'directed': False,\n",
       " 'multigraph': False,\n",
       " 'graph': {},\n",
       " 'nodes': [{'id': '987'},\n",
       "  {'id': '584'},\n",
       "  {'id': '921'},\n",
       "  {'id': '740'},\n",
       "  {'id': '742'},\n",
       "  {'id': '108'},\n",
       "  {'id': '931'},\n",
       "  {'id': '386'},\n",
       "  {'id': '291'},\n",
       "  {'id': '389'},\n",
       "  {'id': '202'},\n",
       "  {'id': '681'},\n",
       "  {'id': '177'},\n",
       "  {'id': '437'}],\n",
       " 'links': [{'weight': 5, 'source': '987', 'target': '584'},\n",
       "  {'weight': 6, 'source': '987', 'target': '931'},\n",
       "  {'weight': 6, 'source': '987', 'target': '921'},\n",
       "  {'weight': 6, 'source': '921', 'target': '740'},\n",
       "  {'weight': 4, 'source': '921', 'target': '742'},\n",
       "  {'weight': 4, 'source': '921', 'target': '108'},\n",
       "  {'weight': 6, 'source': '921', 'target': '202'},\n",
       "  {'weight': 5, 'source': '921', 'target': '681'},\n",
       "  {'weight': 6, 'source': '921', 'target': '386'},\n",
       "  {'weight': 6, 'source': '921', 'target': '931'},\n",
       "  {'weight': 6, 'source': '740', 'target': '931'},\n",
       "  {'weight': 4, 'source': '740', 'target': '742'},\n",
       "  {'weight': 4, 'source': '740', 'target': '108'},\n",
       "  {'weight': 3, 'source': '740', 'target': '177'},\n",
       "  {'weight': 4, 'source': '742', 'target': '108'},\n",
       "  {'weight': 4, 'source': '108', 'target': '291'},\n",
       "  {'weight': 4, 'source': '108', 'target': '177'},\n",
       "  {'weight': 4, 'source': '108', 'target': '437'},\n",
       "  {'weight': 4, 'source': '386', 'target': '291'},\n",
       "  {'weight': 3, 'source': '291', 'target': '389'},\n",
       "  {'weight': 4, 'source': '291', 'target': '177'}]}"
      ]
     },
     "execution_count": 94,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "from networkx.readwrite import json_graph\n",
    "json_graph.node_link_data(G)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 99,
   "metadata": {},
   "outputs": [],
   "source": [
    "metricsdf = pd.DataFrame({'pagerank':pr , 'harmonic_centrality':hc}).sort_values(by=['pagerank'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 103,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "{'pagerank': {'584': 0.008610865813629574,\n",
       "  '681': 0.012437210300474026,\n",
       "  '202': 0.014924652360568832,\n",
       "  '987': 0.03444446522050013,\n",
       "  '931': 0.0430584991207926,\n",
       "  '742': 0.046378749251512766,\n",
       "  '386': 0.04811615640703562,\n",
       "  '177': 0.06665368376028895,\n",
       "  '740': 0.08027843734423781,\n",
       "  '437': 0.09956177582188803,\n",
       "  '389': 0.09989362803485011,\n",
       "  '921': 0.12583140796284634,\n",
       "  '291': 0.14643185511508439,\n",
       "  '108': 0.1733786134862907},\n",
       " 'harmonic_centrality': {'584': 0.9574713856834598,\n",
       "  '681': 1.2325369075369075,\n",
       "  '202': 1.1228418640183349,\n",
       "  '987': 1.3473516679399031,\n",
       "  '931': 1.3704476079476078,\n",
       "  '742': 1.8115440115440118,\n",
       "  '386': 1.483498854087089,\n",
       "  '177': 1.877570528886318,\n",
       "  '740': 1.9418321874204223,\n",
       "  '437': 1.3930827943985837,\n",
       "  '389': 1.4227336389101093,\n",
       "  '921': 2.0901515151515153,\n",
       "  '291': 1.950525351841141,\n",
       "  '108': 2.245634920634921}}"
      ]
     },
     "execution_count": 103,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "metricsdf.to_dict()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
